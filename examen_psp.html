<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Examen Integral PSP (Fusionado)</title>
    <script src="https://cdn.tailwindcss.com"></script>

    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ“š</text></svg>">
    <script data-goatcounter="https://jrenedo.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>

    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .option-card:hover { transform: translateY(-2px); box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); }
    </style>
</head>
<body class="bg-slate-100 min-h-screen flex items-center justify-center p-4">

    <!-- Main Container -->
    <div class="bg-white rounded-2xl shadow-xl w-full max-w-3xl overflow-hidden min-h-[500px] flex flex-col relative">
        
        <!-- Header -->
        <div class="bg-indigo-600 p-6 text-white flex justify-between items-center z-10">
            <h1 class="text-xl font-bold flex items-center gap-2">
                <i class="fas fa-server"></i> Examen PSP (Completo)
            </h1>
            <div id="progress-container" class="hidden text-sm font-medium bg-indigo-500 px-3 py-1 rounded-full">
                <span id="current-question-num">1</span> / <span id="total-questions-num">0</span>
            </div>
        </div>

        <!-- Content Area -->
        <div class="flex-1 p-6 relative flex flex-col justify-center">
            
            <!-- Start Screen -->
            <div id="start-screen" class="text-center space-y-6 fade-in">
                <div class="w-24 h-24 bg-indigo-100 rounded-full flex items-center justify-center mx-auto text-indigo-600 text-4xl mb-4">
                    <i class="fas fa-clipboard-list"></i>
                </div>
                <h2 class="text-3xl font-bold text-slate-800">ProgramaciÃ³n de Servicios y Procesos</h2>
                <p class="text-slate-600 max-w-md mx-auto">
                    Cuestionario interactivo fusionado. Incluye preguntas del examen integral y del segundo documento (evitando duplicados).
                </p>
                <div class="flex flex-col gap-2 max-w-xs mx-auto">
                    <div class="flex items-center gap-2 text-sm text-slate-500 justify-center">
                        <i class="fas fa-random"></i> 76 Preguntas Ãºnicas
                    </div>
                    <div class="flex items-center gap-2 text-sm text-slate-500 justify-center">
                        <i class="fas fa-shuffle"></i> Orden y respuestas aleatorias
                    </div>
                </div>
                <button onclick="startQuiz()" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-8 rounded-full transition-all transform hover:scale-105 shadow-lg mt-4">
                    Comenzar Examen
                </button>
            </div>

            <!-- Quiz Screen -->
            <div id="quiz-screen" class="hidden flex flex-col h-full fade-in">
                <div class="mb-6">
                    <span class="text-xs font-bold text-indigo-600 uppercase tracking-wide mb-1 block">Pregunta</span>
                    <h3 id="question-text" class="text-xl md:text-2xl font-semibold text-slate-800 leading-relaxed">
                        <!-- Question goes here -->
                    </h3>
                </div>

                <div id="options-container" class="grid gap-3 md:grid-cols-1">
                    <!-- Options go here -->
                </div>

                <!-- Feedback / Next Button Area -->
                <div id="feedback-area" class="mt-6 hidden p-4 rounded-lg bg-slate-50 border border-slate-200">
                    <div class="flex items-start gap-3">
                        <div id="feedback-icon" class="text-2xl mt-1"></div>
                        <div>
                            <h4 id="feedback-title" class="font-bold text-lg"></h4>
                            <p id="feedback-justification" class="text-slate-600 mt-1 text-sm leading-relaxed"></p>
                        </div>
                    </div>
                    <div class="mt-4 flex justify-end">
                        <button id="next-btn" onclick="nextQuestion()" class="bg-slate-800 hover:bg-slate-900 text-white font-medium py-2 px-6 rounded-lg transition-colors flex items-center gap-2">
                            Siguiente <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Result Screen -->
            <div id="result-screen" class="hidden text-center space-y-6 fade-in">
                <div class="w-24 h-24 mx-auto rounded-full flex items-center justify-center text-4xl shadow-lg relative" id="score-circle">
                    <!-- Icon handled by JS -->
                </div>
                
                <div>
                    <h2 class="text-3xl font-bold text-slate-800 mb-2">Â¡Examen Finalizado!</h2>
                    <p class="text-slate-600">Tu puntuaciÃ³n final es:</p>
                </div>

                <div class="text-5xl font-black text-indigo-600 tracking-tight" id="final-score">
                    0/0
                </div>

                <div class="w-full bg-slate-200 rounded-full h-4 max-w-md mx-auto overflow-hidden">
                    <div id="final-progress-bar" class="bg-indigo-600 h-4 rounded-full transition-all duration-1000" style="width: 0%"></div>
                </div>
                
                <p id="score-message" class="text-lg font-medium text-slate-700"></p>

                <button onclick="restartQuiz()" class="bg-white border-2 border-indigo-600 text-indigo-600 hover:bg-indigo-50 font-bold py-3 px-8 rounded-full transition-all transform hover:scale-105 mt-6">
                    <i class="fas fa-redo"></i> Intentar de nuevo
                </button>
            </div>

        </div>
    </div>

    <script>
        // --- DATASET: Merged Questions from PSP1 (58) and PSP (1 unique) ---
        const rawQuestions = [
            {
                q: "SegÃºn las prÃ¡cticas de programaciÃ³n segura, Â¿cÃ³mo deben tratarse los archivos de la aplicaciÃ³n para evitar modificaciones externas?",
                options: ["Deben ser archivos ejecutables pÃºblicos.", "Deben tener permisos de escritura total.", "Deben ser siempre archivos ocultos.", "Deben ser de solo lectura."],
                correct: 3, // D
                justification: "El manual indica que los archivos de la aplicaciÃ³n deben ser de solo lectura para prevenir que un usuario los modifique malintencionadamente."
            },
            {
                q: "Â¿QuÃ© fase del control de acceso se encarga de verificar fehacientemente que el usuario es quien dice ser (ej. mediante contraseÃ±a)?",
                options: ["IdentificaciÃ³n.", "AutorizaciÃ³n.", "AutenticaciÃ³n.", "Registro."],
                correct: 2, // C
                justification: "La autenticaciÃ³n es el proceso donde el sistema comprueba la identidad declarada del usuario."
            },
            {
                q: "Â¿CÃ³mo se denomina al Ãºltimo paso del control de acceso que ofrece el recurso si el proceso previo fue exitoso?",
                options: ["AutorizaciÃ³n.", "VerificaciÃ³n.", "AutenticaciÃ³n.", "IdentificaciÃ³n."],
                correct: 0, // A
                justification: "La autorizaciÃ³n es la fase final que concede el acceso a la informaciÃ³n o recursos tras una autenticaciÃ³n positiva."
            },
            {
                q: "Â¿QuÃ© tÃ©cnica de autenticaciÃ³n reduce el factor humano utilizando rasgos como la retina o la huella dactilar?",
                options: ["Cifrado asimÃ©trico.", "BiometrÃ­a.", "Firma digital.", "CertificaciÃ³n."],
                correct: 1, // B
                justification: "La biometrÃ­a engloba lectores fÃ­sicos que ofrecen mayor seguridad al eliminar la vulnerabilidad del factor humano."
            },
            {
                q: "En Java, Â¿quÃ© mÃ©todo de la clase Cipher realiza la operaciÃ³n final de encriptaciÃ³n o desencriptaciÃ³n de los datos?",
                options: ["init().", "update().", "doFinal().", "getInstance()."],
                correct: 2, // C
                justification: "El mÃ©todo doFinal() es el encargado de ejecutar la transformaciÃ³n criptogrÃ¡fica final sobre los datos."
            },
            {
                q: "Â¿CuÃ¡l es la funciÃ³n principal de las tres condiciones de Bernstein?",
                options: ["Determinar si dos instrucciones pueden ejecutarse concurrentemente.", "Generar claves pÃºblicas y privadas para RSA.", "Establecer un tÃºnel seguro mediante SSH.", "Sincronizar hilos mediante el uso de monitores."],
                correct: 0, // A
                justification: "Bernstein estableciÃ³ condiciones de intersecciÃ³n vacÃ­a entre conjuntos de lectura y escritura para permitir la ejecuciÃ³n simultÃ¡nea."
            },
            {
                q: "Â¿QuÃ© tÃ©cnica divide un problema grande en partes pequeÃ±as para resolverlas simultÃ¡neamente en equipos multiprocesadores?",
                options: ["ProgramaciÃ³n distribuida.", "ProgramaciÃ³n paralela.", "ProgramaciÃ³n iterativa.", "ProgramaciÃ³n monohilo."],
                correct: 1, // B
                justification: "La programaciÃ³n paralela ejecuta muchas instrucciones a la vez dividiendo problemas de grandes dimensiones."
            },
            {
                q: "Â¿QuÃ© define a los archivos ejecutables desde el punto de vista del sistema operativo?",
                options: ["Son archivos de texto con el cÃ³digo fuente original.", "Son carpetas que contienen exclusivamente librerÃ­as Java.", "Son archivos binarios con instrucciones en lenguaje mÃ¡quina.", "Son procesos que requieren siempre una interfaz grÃ¡fica."],
                correct: 2, // C
                justification: "Los ejecutables contienen el cÃ³digo fuente ya traducido por el compilador para ser entendido directamente por el microprocesador."
            },
            {
                q: "Â¿QuÃ© caracterÃ­stica define especÃ­ficamente a un 'servicio'?",
                options: ["Se ejecuta en segundo plano y carece de interfaz grÃ¡fica.", "Es controlado permanentemente por el usuario de forma directa.", "Finaliza inmediatamente tras su primera instrucciÃ³n.", "Solo puede ejecutarse en sistemas monohilo."],
                correct: 0, // A
                justification: "Los servicios son procesos que funcionan en segundo plano, destinados a tareas de mantenimiento o procesos continuos sin interacciÃ³n directa."
            },
            {
                q: "Â¿QuÃ© funciÃ³n se utiliza especÃ­ficamente en sistemas Windows para solicitar la creaciÃ³n de un nuevo proceso?",
                options: ["fork().", "createProcess().", "new Thread().", "start()."],
                correct: 1, // B
                justification: "Mientras que en Linux se usa fork(), en Windows la funciÃ³n nativa es createProcess()."
            },
            {
                q: "Â¿QuÃ© efecto tiene invocar el mÃ©todo sleep() sobre un proceso o hilo?",
                options: ["Detiene su ejecuciÃ³n de forma permanente.", "Pausa el hilo durante una cantidad determinada de milisegundos.", "Termina el mÃ©todo run() de forma ordenada.", "Despierta a todos los hilos que estÃ¡n en espera."],
                correct: 1, // B
                justification: "El mÃ©todo sleep() detiene la ejecuciÃ³n del hilo actual por el tiempo especificado en sus parÃ¡metros."
            },
            {
                q: "Al comparar hilos y procesos, Â¿cuÃ¡l es una ventaja competitiva fundamental de los hilos?",
                options: ["Los hilos no comparten memoria entre sÃ­.", "Son totalmente independientes del proceso que los creÃ³.", "Tienen un menor coste de creaciÃ³n y cambio de contexto.", "Requieren una mayor reserva de recursos del sistema operativo."],
                correct: 2, // C
                justification: "Crear un hilo es mÃ¡s rÃ¡pido y econÃ³mico en recursos que crear un proceso debido a que comparten memoria."
            },
            {
                q: "Â¿QuÃ© mÃ©todo se utiliza para despertar hilos bloqueados y NO para detener el hilo actual?",
                options: ["notify().", "wait().", "sleep().", "suspend()."],
                correct: 0, // A
                justification: "Mientras wait o sleep bloquean el hilo, notify se usa para enviar una seÃ±al de reactivaciÃ³n a otros hilos."
            },
            {
                q: "Â¿En quÃ© momento se considera que un hilo ha pasado definitivamente al estado 'Muerto'?",
                options: ["Cuando invoca el mÃ©todo yield().", "Cuando finaliza la ejecuciÃ³n de su mÃ©todo run().", "Cuando se bloquea por una operaciÃ³n de entrada/salida.", "Al entrar en una secciÃ³n crÃ­tica synchronized."],
                correct: 1, // B
                justification: "Un hilo muere al terminar sus instrucciones en el mÃ©todo run() o por una parada externa."
            },
            {
                q: "Â¿En quÃ© capa del modelo TCP/IP se ubican protocolos como HTTP, FTP y DNS?",
                options: ["Capa de Internet.", "Capa de Transporte.", "Capa de AplicaciÃ³n.", "Capa de Red."],
                correct: 2, // C
                justification: "La capa de aplicaciÃ³n maneja protocolos de alto nivel que implementan servicios para el usuario."
            },
            {
                q: "Â¿QuÃ© mecanismo permite la comunicaciÃ³n entre aplicaciones abstrayendo al usuario de las capas inferiores?",
                options: ["Sockets.", "RMI.", "DatagramPacket.", "TuberÃ­as."],
                correct: 0, // A
                justification: "Un socket crea un canal de comunicaciÃ³n entre aplicaciones a travÃ©s de la red simplificando el intercambio."
            },
            {
                q: "Â¿QuÃ© protocolo de transporte se caracteriza por ser orientado a conexiÃ³n y fiable?",
                options: ["UDP.", "TCP.", "IP.", "ICMP."],
                correct: 1, // B
                justification: "TCP asegura la entrega ordenada y fiable de paquetes mediante una conexiÃ³n previa."
            },
            {
                q: "En la programaciÃ³n de sockets, Â¿quÃ© mÃ©todo vincula el socket a una direcciÃ³n IP y puerto local?",
                options: ["connect().", "accept().", "bind().", "listen()."],
                correct: 2, // C
                justification: "El mÃ©todo bind() realiza el enlazamiento del socket a una direcciÃ³n y puerto determinados."
            },
            {
                q: "Â¿QuÃ© funciÃ³n de ServerSocket bloquea la ejecuciÃ³n esperando una peticiÃ³n de conexiÃ³n entrante?",
                options: ["bind().", "accept().", "read().", "close()."],
                correct: 1, // B
                justification: "El mÃ©todo accept() detiene al servidor hasta que recibe y acepta la conexiÃ³n de un cliente."
            },
            {
                q: "Â¿QuÃ© protocolo permite asignar dinÃ¡micamente direcciones IP a los clientes de una red?",
                options: ["DNS.", "DHCP.", "SMTP.", "NFS."],
                correct: 1, // B
                justification: "El servidor configurado con DHCP asigna IPs de forma automÃ¡tica a los dispositivos que se conectan."
            },
            {
                q: "Â¿CuÃ¡ndo es aconsejable utilizar un servidor concurrente en lugar de uno iterativo?",
                options: ["Cuando solo se atiende una peticiÃ³n cada vez.", "Cuando hay una gran cantidad de peticiones simultÃ¡neas.", "Si el coste de recursos es muy elevado para procesos cortos.", "Cuando se utiliza exclusivamente el protocolo UDP."],
                correct: 1, // B
                justification: "Los servidores concurrentes permiten atender a mÃºltiples clientes a la vez mediante hilos."
            },
            {
                q: "Â¿QuÃ© tÃ©cnica es conceptualmente parecida a RMI pero basada en programaciÃ³n estructurada?",
                options: ["SOAP.", "RPC (Remote Procedure Call).", "REST.", "TCP."],
                correct: 1, // B
                justification: "El RPC es la variante estructurada para invocar procedimientos remotos, similar al RMI orientado a objetos."
            },
            {
                q: "Â¿QuÃ© herramienta distribuye las peticiones masivas entre servidores para evitar colapsos?",
                options: ["Servidor dedicado.", "Balanceadores de carga.", "RÃ©plicas de servidores.", "MonitorizaciÃ³n."],
                correct: 1, // B
                justification: "Los balanceadores distribuyen la carga de trÃ¡fico masivo para optimizar rendimiento."
            },
            {
                q: "Â¿CÃ³mo se denomina al equipo informÃ¡tico que es Ãºnico para una empresa y no se comparte?",
                options: ["Servidor compartido.", "Servidor espejo.", "Servidor dedicado.", "Servidor concurrente."],
                correct: 2, // C
                justification: "Un servidor dedicado es aquel recurso Ãºnico para una organizaciÃ³n."
            },
            {
                q: "Â¿CuÃ¡ntos bits genera un resumen mediante el algoritmo hash MD5?",
                options: ["160 bits.", "128 bits.", "256 bits.", "64 bits."],
                correct: 1, // B
                justification: "El algoritmo MD5 genera resÃºmenes de longitud fija de 128 bits."
            },
            {
                q: "La seguridad del algoritmo RSA se basa en la dificultad de resolver:",
                options: ["La sustituciÃ³n de caracteres.", "La factorizaciÃ³n de nÃºmeros enteros.", "La exclusiÃ³n mutua.", "La condiciÃ³n de carrera."],
                correct: 1, // B
                justification: "RSA utiliza pares de nÃºmeros hallados mediante operaciones con nÃºmeros primos grandes."
            },
            {
                q: "Â¿QuÃ© puerto utiliza habitualmente el protocolo SSH?",
                options: ["80.", "443.", "22.", "21."],
                correct: 2, // C
                justification: "El puerto estÃ¡ndar para la comunicaciÃ³n segura mediante el intÃ©rprete de Ã³rdenes seguro es el 22."
            },
            {
                q: "Â¿QuÃ© problema ocurre cuando dos procesos se bloquean esperando recursos que el otro retiene?",
                options: ["InaniciÃ³n.", "ExclusiÃ³n mutua.", "Abrazo mortal (Deadlock).", "Inconsistencia."],
                correct: 2, // C
                justification: "El deadlock es el interbloqueo mutuo entre procesos por dependencia de recursos."
            },
            {
                q: "Â¿QuÃ© comando de Linux muestra los procesos activos detallando el UID y el PID?",
                options: ["ls -l.", "ps -f.", "renice.", "taskset."],
                correct: 1, // B
                justification: "El comando ps -f es el encargado de listar los procesos activos con su informaciÃ³n tÃ©cnica."
            },
            {
                q: "Â¿CuÃ¡l es el rango de prioridad de un hilo en el lenguaje Java?",
                options: ["Entre 1 y 10.", "Entre 0 y 100.", "Entre -20 y 20.", "Entre 1 y 5."],
                correct: 0, // A
                justification: "Java utiliza un rango de 1 (MIN_PRIORITY) a 10 (MAX_PRIORITY)."
            },
            {
                q: "Â¿QuÃ© mensaje inicia el 'Three-way handshake' en una conexiÃ³n TCP?",
                options: ["ACK.", "FIN.", "SYN.", "SYN-ACK."],
                correct: 2, // C
                justification: "El cliente solicita la conexiÃ³n enviando el mensaje de sincronizaciÃ³n SYN."
            },
            {
                q: "Â¿QuÃ© lenguaje utiliza obligatoriamente el protocolo SOAP para sus mensajes?",
                options: ["JSON.", "HTML.", "XML.", "Texto plano."],
                correct: 2, // C
                justification: "SOAP define la comunicaciÃ³n de objetos mediante el lenguaje XML."
            },
            {
                q: "Â¿CuÃ¡les son las operaciones estÃ¡ndares de los servicios web REST?",
                options: ["SYN, ACK, FIN.", "POST, GET, PUT y DELETE.", "START, RUN, STOP.", "BIND, ACCEPT, SEND."],
                correct: 1, // B
                justification: "REST basa su uso en los verbos estÃ¡ndar de HTTP."
            },
            {
                q: "Â¿QuÃ© librerÃ­a externa de Java se usa habitualmente para clientes FTP?",
                options: ["Java Standard API.", "Apache Commons Net.", "Google Guava.", "RMI Registry."],
                correct: 1, // B
                justification: "Esta librerÃ­a proporciona clases como FTPClient para la gestiÃ³n de transferencias."
            },
            {
                q: "Â¿CÃ³mo se denomina a un proceso finalizado que aÃºn no ha liberado sus recursos en Unix?",
                options: ["HuÃ©rfano.", "Zombie.", "Activo.", "Bloqueado."],
                correct: 1, // B
                justification: "Los procesos zombies han terminado su ejecuciÃ³n pero mantienen su entrada en la tabla de procesos."
            },
            {
                q: "Â¿QuÃ© palabra clave de Java evita que varios hilos usen a la vez un recurso compartido?",
                options: ["volatile.", "synchronized.", "static.", "final."],
                correct: 1, // B
                justification: "synchronized bloquea el acceso de otros hilos al objeto marcado hasta que el actual termina."
            },
            {
                q: "Â¿QuÃ© clase de Java representa una direcciÃ³n IP?",
                options: ["URL.", "InetAddress.", "Socket.", "ServerSocket."],
                correct: 1, // B
                justification: "InetAddress es la clase especÃ­fica del API de Java para representar IPs."
            },
            {
                q: "La capacidad de contar con servidores rÃ©plica para evitar interrupciones se conoce como:",
                options: ["Balanceo de carga.", "Alta disponibilidad.", "ProgramaciÃ³n paralela.", "Encadenamiento."],
                correct: 1, // B
                justification: "La alta disponibilidad garantiza un servicio cercano al 100% mediante rÃ©plicas activas."
            },
            {
                q: "Â¿QuÃ© puerto utiliza el protocolo HTTPS por defecto?",
                options: ["80.", "22.", "443.", "21."],
                correct: 2, // C
                justification: "HTTPS aÃ±ade seguridad a HTTP utilizando el puerto 443."
            },
            {
                q: "Â¿QuÃ© servicio asegura que un emisor no pueda negar haber enviado un mensaje?",
                options: ["Confidencialidad.", "No repudio en origen.", "Disponibilidad.", "Integridad."],
                correct: 1, // B
                justification: "El no repudio en origen aporta pruebas de que el emisor enviÃ³ el mensaje."
            },
            {
                q: "Â¿QuÃ© mÃ©todo inicializa e inicia realmente la ejecuciÃ³n de un hilo en Java?",
                options: ["start().", "run().", "init().", "execute()."],
                correct: 0, // A
                justification: "El mÃ©todo start() crea el hilo y llama automÃ¡ticamente al mÃ©todo run()."
            },
            {
                q: "Â¿En quÃ© nivel del modelo TCP/IP se realiza la divisiÃ³n del mensaje en paquetes?",
                options: ["Nivel de aplicaciÃ³n.", "Nivel de transporte.", "Nivel de Internet.", "Nivel de red."],
                correct: 1, // B
                justification: "El nivel de transporte es el encargado de segmentar la informaciÃ³n en paquetes para el envÃ­o."
            },
            {
                q: "Para una programaciÃ³n segura: un cÃ³digo limpio aporta seguridad, la reutilizaciÃ³n debe ser de cÃ³digo revisado y se debe eliminar el cÃ³digo obsoleto. Â¿Es correcto?",
                options: ["SÃ­, todas son prÃ¡cticas recomendadas.", "No, el cÃ³digo obsoleto no afecta.", "No, no se debe reutilizar nunca cÃ³digo.", "SÃ­, pero solo si es cÃ³digo Java."],
                correct: 0, // A
                justification: "Son principios fundamentales para evitar confusiones y vulnerabilidades en la aplicaciÃ³n."
            },
            {
                q: "Â¿QuÃ© informaciÃ³n se considera 'sensible' en una base de datos?",
                options: ["Solo la contraseÃ±a.", "Solo el DNI.", "Solo la direcciÃ³n fÃ­sica.", "ContraseÃ±a, DNI y direcciÃ³n fÃ­sica (todas las anteriores)."],
                correct: 3, // D
                justification: "Se considera sensible cualquier informaciÃ³n privada del usuario."
            },
            {
                q: "Â¿QuÃ© informaciÃ³n mantiene un hilo como contexto propio e independiente dentro del proceso?",
                options: ["Claves criptogrÃ¡ficas.", "Identificador, pila y contador de programa.", "CÃ³digo fuente y datos globales.", "Recursos compartidos del sistema operativo."],
                correct: 1, // B
                justification: "Aunque comparten datos del proceso, los hilos tienen su propia pila y registro contador."
            },
            {
                q: "Â¿QuÃ© identifica de forma completa y Ãºnica una conexiÃ³n TCP?",
                options: ["Solo la IP del servidor.", "El protocolo HTTP.", "IP origen, IP destino y los puertos de ambos.", "El nombre del host cliente."],
                correct: 2, // C
                justification: "Un socket TCP se define por el conjunto (IP, puerto) de ambos extremos."
            },
            {
                q: "Â¿CuÃ¡l es el objetivo principal de la planificaciÃ³n de procesos del sistema operativo?",
                options: ["Eliminar procesos inactivos permanentemente.", "Asignar memoria RAM de forma estÃ¡tica.", "Decidir quÃ© proceso usa la CPU en cada momento.", "Compilar los archivos ejecutables."],
                correct: 2, // C
                justification: "El planificador gestiona el reparto del tiempo de procesador entre los procesos preparados."
            },
            {
                q: "Â¿QuÃ© ocurre cuando un hilo modifica un dato compartido en la memoria del proceso?",
                options: ["Los demÃ¡s hilos del mismo proceso pueden ver el cambio.", "El cambio se pierde si el hilo no lo guarda en disco.", "El sistema operativo bloquea el hilo inmediatamente.", "Se crea una copia privada para el resto de hilos."],
                correct: 0, // A
                justification: "Los hilos comparten la secciÃ³n de datos del proceso padre."
            },
            {
                q: "Â¿QuÃ© define fundamentalmente a un protocolo criptogrÃ¡fico?",
                options: ["Un lenguaje de programaciÃ³n nuevo.", "Reglas para la seguridad en la comunicaciÃ³n de sistemas.", "Un algoritmo de compresiÃ³n de datos.", "Un tipo de sistema operativo seguro."],
                correct: 1, // B
                justification: "Especifican cÃ³mo utilizar algoritmos para establecer claves, autenticar entidades, etc."
            },
            {
                q: "Â¿CuÃ¡l es el inconveniente principal de UDP frente a TCP?",
                options: ["Es mucho mÃ¡s lento en transferencia.", "Requiere una conexiÃ³n previa muy pesada.", "No garantiza la entrega de los mensajes.", "No permite enviar paquetes de datos."],
                correct: 2, // C
                justification: "UDP es un protocolo no fiable porque no realiza acuse de recibo ni ordenamiento."
            },
            {
                q: "Â¿QuÃ© herramienta permite supervisar el estado de disponibilidad inmediata de un servicio?",
                options: ["Editor de cÃ³digo.", "Compilador.", "Herramientas de monitorizaciÃ³n.", "Depurador."],
                correct: 2, // C
                justification: "Los administradores usan herramientas de monitorizaciÃ³n para realizar acciones de mantenimiento inmediatas."
            },
            {
                q: "Â¿QuÃ© clase de Java permite al servidor aceptar especÃ­ficamente conexiones TCP entrantes?",
                options: ["ServerSocket.", "URL.", "DatagramPacket.", "HttpURLConnection."],
                correct: 0, // A
                justification: "ServerSocket es la clase que escucha en un puerto peticiones de clientes TCP."
            },
            {
                q: "Â¿QuÃ© componente documenta el catÃ¡logo de funciones accesibles de un servicio para desarrolladores?",
                options: ["BCP.", "API.", "RMI.", "Socket."],
                correct: 1, // B
                justification: "Una API proporciona los mÃ©todos y parÃ¡metros definidos para interactuar con un software."
            },
            {
                q: "Â¿QuÃ© tipo de criptografÃ­a utiliza una Ãºnica clave compartida para cifrar y descifrar?",
                options: ["CriptografÃ­a asimÃ©trica.", "CriptografÃ­a simÃ©trica.", "FunciÃ³n Hash.", "Firma digital."],
                correct: 1, // B
                justification: "En la simÃ©trica, emisor y receptor comparten la misma clave secreta."
            },
            {
                q: "En el modelo cliente-servidor, Â¿quÃ© rol es el encargado de iniciar normalmente la comunicaciÃ³n?",
                options: ["El servidor.", "El cliente.", "El router.", "El firewall."],
                correct: 1, // B
                justification: "Los clientes realizan las peticiones iniciales y los servidores responden."
            },
            {
                q: "Â¿QuÃ© funciÃ³n tienen los puntos de interrupciÃ³n (breakpoints) en el desarrollo?",
                options: ["Muestran valores para comprobar que los datos son correctos.", "Determinan si el depurador debe parar la ejecuciÃ³n en un punto.", "Permiten verificar la trazabilidad de la aplicaciÃ³n.", "Todas las respuestas son correctas."],
                correct: 3, // D
                justification: "Se usan como herramientas de depuraciÃ³n para analizar el estado del programa en puntos crÃ­ticos."
            },
            {
                q: "SegÃºn los casos prÃ¡cticos, Â¿quÃ© algoritmo se utiliza en Java para cifrar una variable 'Mensaje' en modo ECB?",
                options: ["RSA.", "MD5.", "AES.", "SHA-256."],
                correct: 2, // C
                justification: "El caso prÃ¡ctico 2 requiere programar una clase usando AES/ECB para cifrado."
            },
            {
                q: "En Linux, Â¿quÃ© instrucciÃ³n permite cambiar la prioridad de un proceso que ya estÃ¡ en ejecuciÃ³n?",
                options: ["nice.", "renice.", "taskset.", "ps -l."],
                correct: 1, // B
                justification: "nice se usa al iniciar un proceso, mientras que renice modifica la prioridad de uno ya existente."
            },
            {
                q: "Â¿QuÃ© tÃ©cnica se utiliza para dividir un mensaje en paquetes en el nivel de transporte del modelo TCP/IP?",
                options: ["EncapsulaciÃ³n.", "FragmentaciÃ³n en paquetes.", "Handshake.", "InvocaciÃ³n remota."],
                correct: 1, // B
                justification: "La fragmentaciÃ³n o segmentaciÃ³n ocurre en el nivel de transporte para dividir el mensaje en unidades manejables."
            },
            {
        q: "Â¿QuÃ© mÃ©todo estÃ¡tico de la clase Cipher se utiliza para crear una instancia del objeto especificando el algoritmo de cifrado (ej: 'AES/ECB/PKCS5Padding')?",
        options: ["Cipher.init()", "Cipher.getInstance()", "Cipher.create()", "Cipher.update()"],
        correct: 1, // B
        justification: "El mÃ©todo getInstance() es el encargado de instanciar la clase Cipher con la transformaciÃ³n solicitada para poder usarla."
    },
    {
        q: "SegÃºn el protocolo TCP, Â¿cuÃ¡l es la secuencia correcta de mensajes para cerrar una conexiÃ³n (Handshake de fin)?",
        options: ["El cliente envÃ­a FIN y la conexiÃ³n se corta inmediatamente.", "Secuencia de 4 pasos: FIN (Cliente) -> ACK (Servidor) -> FIN (Servidor) -> ACK (Cliente).", "El servidor envÃ­a RST al cliente para finalizar.", "El cliente envÃ­a un paquete STOP y espera confirmaciÃ³n."],
        correct: 1, // B
        justification: "El cierre ordenado requiere que ambos extremos confirmen el fin: primero uno envÃ­a FIN y recibe ACK, luego el otro envÃ­a su FIN y recibe su ACK."
    },
    {
        q: "Â¿QuÃ© protocolo de la capa de aplicaciÃ³n es el estÃ¡ndar utilizado para el envÃ­o y transferencia de correo electrÃ³nico?",
        options: ["POP3.", "IMAP.", "SMTP.", "HTTP."],
        correct: 2, // C
        justification: "SMTP (Simple Mail Transfer Protocol) es el protocolo diseÃ±ado para el intercambio y envÃ­o de correos, mientras que POP3/IMAP son para la recepciÃ³n."
    },
            {
        q: "SegÃºn el solucionario del libro, Â¿quÃ© ventaja principal ofrece REST frente a SOAP en comunicaciones simultÃ¡neas?",
        options: [
            "REST utiliza un cifrado mÃ¡s potente que SOAP.",
            "Los mensajes enviados definen todo lo necesario para procesarse, por lo que el servidor no necesita almacenar el estado (Stateless).",
            "REST permite el uso de protocolos de transporte distintos a HTTP.",
            "SOAP no permite el envÃ­o de datos binarios."
        ],
        correct: 1, // B
        justification: "Texto literal del solucionario (5.5): 'Los mensajes definen todo lo necesario... por lo que ni cliente ni servidor deben almacenar el estado'."
    },
    {
        q: "Â¿QuÃ© mÃ©todo de la clase Thread devuelve la REFERENCIA al objeto hilo que se estÃ¡ ejecutando actualmente (no su ID)?",
        options: [
            "long getId()",
            "static Thread currentThread()",
            "void interrupt()",
            "String getName()"
        ],
        correct: 1, // B
        justification: "Cuidado con la trampa: getId() devuelve un nÃºmero (long), pero currentThread() devuelve la referencia al propio objeto (Thread) en ejecuciÃ³n."
    },
    {
        q: "Â¿QuÃ© elementos identifican de forma COMPLETA y Ãºnica una conexiÃ³n de socket establecida entre dos mÃ¡quinas?",
        options: [
            "Solo la IP y puerto del servidor.",
            "La IP de origen y la IP de destino Ãºnicamente.",
            "Protocolo, IP origen, Puerto origen, IP destino y Puerto destino.",
            "El nombre de dominio y la direcciÃ³n MAC."
        ],
        correct: 2, // C
        justification: "Aunque un socket local es IP:Puerto, la conexiÃ³n completa (el tÃºnel) se identifica por los 5 valores: Protocolo + IP/Puerto de ambos extremos."
    },
    {
        q: "En las condiciones de Bernstein, si la intersecciÃ³n entre el Conjunto de Lectura 1 (L1) y el Conjunto de Lectura 2 (L2) es vacÃ­a, Â¿podemos asegurar que hay concurrencia?",
        options: [
            "SÃ­, porque no comparten datos leÃ­dos.",
            "No, porque las condiciones de Bernstein solo comparan Escritura vs Lectura o Escritura vs Escritura.",
            "SÃ­, es la condiciÃ³n principal de Bernstein.",
            "No, porque siempre debe haber intersecciÃ³n en las lecturas."
        ],
        correct: 1, // B
        justification: "Pregunta trampa: Dos procesos pueden leer lo mismo a la vez sin problemas. Bernstein se centra en conflictos de modificaciÃ³n (Escritura). Saber solo L1 y L2 no determina si hay conflicto de escritura."
    },
    {
        q: "Â¿CuÃ¡l es la consecuencia funcional principal de NO utilizar hilos (servidor iterativo) en un servidor web?",
        options: [
            "El servidor consume mÃ¡s memoria RAM.",
            "Solo se puede atender una Ãºnica peticiÃ³n a la vez (de forma secuencial).",
            "El cÃ³digo es mucho mÃ¡s complejo de mantener.",
            "No se pueden utilizar sockets TCP."
        ],
        correct: 1, // B
        justification: "Aunque los hilos ahorran recursos, la razÃ³n funcional de usarlos es que un servidor 'sin hilos' (iterativo) bloquea a todos los usuarios hasta que termina con el primero."
    },
            {
        q: "Â¿CuÃ¡l de las siguientes NO es una de las tres condiciones de Bernstein necesarias para que dos procesos (P1 y P2) puedan ejecutarse concurrentemente?",
        options: [
            "L(P1) âˆ© E(P2) = Ã˜ (IntersecciÃ³n vacÃ­a entre Lectura de 1 y Escritura de 2).",
            "E(P1) âˆ© L(P2) = Ã˜ (IntersecciÃ³n vacÃ­a entre Escritura de 1 y Lectura de 2).",
            "E(P1) âˆ© E(P2) = Ã˜ (IntersecciÃ³n vacÃ­a entre Escrituras de ambos).",
            "L(P1) âˆ© L(P2) = Ã˜ (IntersecciÃ³n vacÃ­a entre Lecturas de ambos)."
        ],
        correct: 3, // D
        justification: "Bernstein NO prohÃ­be que dos procesos lean la misma variable a la vez. El conflicto solo existe si al menos uno de ellos escribe (modifica) el dato."
    },
    {
        q: "En la notaciÃ³n de las condiciones de Bernstein, Â¿quÃ© representa habitualmente el conjunto E(Pi)?",
        options: [
            "El conjunto de variables de Entrada (Lectura).",
            "El conjunto de Errores del proceso.",
            "El conjunto de variables de Escritura (Salida/ModificaciÃ³n).",
            "El conjunto de Estados del proceso."
        ],
        correct: 2, // C
        justification: "E(Pi) o W(Pi) representa el conjunto de Escritura (Write/Output), es decir, las variables que el proceso va a alterar durante su ejecuciÃ³n."
    },
    {
        q: "Si se cumplen las tres condiciones de Bernstein entre dos procesos, Â¿quÃ© propiedad importante se garantiza?",
        options: [
            "Que los procesos se ejecutarÃ¡n mÃ¡s rÃ¡pido.",
            "El determinismo: el resultado final serÃ¡ el mismo independientemente de si se ejecutan secuencial o concurrentemente.",
            "Que no habrÃ¡ interbloqueos (Deadlocks) bajo ninguna circunstancia.",
            "Que el sistema operativo asignarÃ¡ mÃ¡s prioridad a estos procesos."
        ],
        correct: 1, // B
        justification: "El objetivo de Bernstein es garantizar que la ejecuciÃ³n paralela no corrompa los datos, asegurando que el resultado sea determinista (igual que si fueran uno detrÃ¡s de otro)."
    },
            {
        q: "RA2 - Â¿QuÃ© estado tiene un hilo creado pero aÃºn no ejecutado?",
        options: ["Muerto", "Bloqueado", "EjecuciÃ³n", "Listo"],
        correct: 3, // D - Listo
        justification: "Estado del ciclo de vida: el hilo ha sido creado y estÃ¡ a la espera de que el planificador le asigne la CPU."
    },
    {
        q: "RA1 - Â¿QuÃ© es un proceso en un sistema operativo?",
        options: ["Un hilo independiente del hardware", "Un programa en ejecuciÃ³n gestionado por el sistema operativo", "Un archivo ejecutable almacenado en disco", "Un servicio exclusivo del usuario"],
        correct: 1, // B - Un programa en ejecuciÃ³n...
        justification: "DefiniciÃ³n literal: Un proceso es un programa dinÃ¡mico en ejecuciÃ³n, a diferencia del archivo estÃ¡tico en disco."
    },
    {
        q: "RA1 - Â¿QuÃ© elemento permite ejecutar tareas de forma concurrente dentro de un proceso?",
        options: ["Servicios", "Ejecutables", "Hilos", "Drivers"],
        correct: 2, // C - Hilos
        justification: "Los hilos (threads) son las unidades que comparten los recursos del proceso padre para trabajar simultÃ¡neamente."
    },
    {
        q: "RA5 - Â¿QuÃ© prÃ¡ctica mejora la seguridad del cÃ³digo?",
        options: ["Evitar revisiones", "Validar los datos de entrada", "Usar solo bajo nivel", "Reutilizar cÃ³digo obsoleto"],
        correct: 1, // B - Validar los datos...
        justification: "La validaciÃ³n de inputs es fundamental para evitar inyecciones y errores no controlados."
    },
    {
        q: "RA1 - Â¿QuÃ© ocurre si dos procesos acceden sin control a un recurso compartido?",
        options: ["Los procesos se detienen", "El sistema siempre lo evita automÃ¡ticamente", "Se crea un nuevo hilo", "Pueden producirse inconsistencias"],
        correct: 3, // D - Pueden producirse inconsistencias
        justification: "Sin mecanismos de sincronizaciÃ³n (como semÃ¡foros o monitores), los datos pueden corromperse (condiciÃ³n de carrera)."
    },
    {
        q: "RA5 - Â¿QuÃ© elemento es clave en protocolos criptogrÃ¡ficos?",
        options: ["GestiÃ³n de hilos", "Balanceo de carga", "PlanificaciÃ³n de procesos", "Establecimiento de claves"],
        correct: 3, // D - Establecimiento de claves
        justification: "Los protocolos seguros definen cÃ³mo se generan, intercambian y establecen las claves para el cifrado."
    },
            // --- PREGUNTAS LITERALES DEL MODELO DE EXAMEN ---
    {
        q: "RA1 - Â¿QuÃ© estado indica que un proceso estÃ¡ usando la CPU?",
        options: ["Bloqueado", "EjecuciÃ³n", "Listo", "Terminado"],
        correct: 1, // B
        justification: "El proceso en ejecuciÃ³n es el que tiene el control del procesador en ese instante."
    },
    {
        q: "RA4 - Â¿QuÃ© tecnologÃ­a permite invocar mÃ©todos remotos en Java?",
        options: ["RMI", "FTP", "DNS", "HTTP"],
        correct: 0, // A
        justification: "RMI (Remote Method Invocation) permite llamar a mÃ©todos de objetos en otras mÃ¡quinas virtuales."
    },
    {
        q: "RA3 - Â¿QuÃ© rol inicia normalmente la comunicaciÃ³n en red?",
        options: ["Router", "Servidor", "Cliente", "Firewall"],
        correct: 2, // C
        justification: "El cliente es quien solicita el inicio de la conexiÃ³n hacia el servidor."
    },
    {
        q: "RA3 - Â¿QuÃ© clase Java permite aceptar conexiones entrantes?",
        options: ["DatagramSocket", "URL", "ServerSocket", "Socket"],
        correct: 2, // C
        justification: "ServerSocket se utiliza en el lado servidor para esperar y aceptar peticiones."
    },
    {
        q: "RA1 - Â¿QuÃ© objetivo tiene la planificaciÃ³n de procesos?",
        options: ["Decidir quÃ© proceso usa la CPU en cada momento", "Compilar los ejecutables", "Eliminar procesos inactivos", "Asignar memoria permanente a los procesos"],
        correct: 0, // A
        justification: "El planificador del SO decide los turnos de uso del procesador."
    },
    {
        q: "RA5 - Â¿QuÃ© define un protocolo criptogrÃ¡fico?",
        options: ["Un algoritmo aislado", "Un sistema operativo", "Un lenguaje de programaciÃ³n", "Reglas para comunicaciones seguras"],
        correct: 3, // D
        justification: "Conjunto de reglas que gobiernan el intercambio seguro de informaciÃ³n."
    },
    {
        q: "RA5 - Â¿QuÃ© prÃ¡ctica es segura al trabajar con archivos?",
        options: ["Abrirlos en modo escritura siempre", "Ejecutarlos desde la app", "Controlar permisos de acceso", "Usar rutas absolutas pÃºblicas"],
        correct: 2, // C
        justification: "La restricciÃ³n de permisos es bÃ¡sica para la seguridad de la informaciÃ³n."
    },
    {
        q: "RA2 - Â¿QuÃ© mÃ©todo pausa un hilo durante un tiempo determinado?",
        options: ["stop()", "sleep()", "notify()", "wait()"],
        correct: 1, // B
        justification: "sleep() detiene la ejecuciÃ³n el tiempo especificado en milisegundos."
    },
    {
        q: "RA4 - Â¿QuÃ© protocolo utiliza XML para servicios web?",
        options: ["SOAP", "UDP", "RPC", "REST"],
        correct: 0, // A
        justification: "SOAP utiliza exclusivamente XML para el formato de sus mensajes."
    },
    {
        q: "RA4 - Â¿QuÃ© caracteriza a un servidor concurrente?",
        options: ["No usa hilos", "Atiende varias peticiones a la vez", "Usa solo UDP", "Atiende una peticiÃ³n cada vez"],
        correct: 1, // B
        justification: "Utiliza hilos o procesos hijos para gestionar mÃºltiples clientes simultÃ¡neamente."
    },
    {
        q: "RA1 - Â¿QuÃ© caracterÃ­stica define a un servicio del sistema?",
        options: ["Solo se inicia manualmente", "Se ejecuta en segundo plano sin interacciÃ³n directa del usuario", "Finaliza tras una Ãºnica ejecuciÃ³n", "Siempre requiere interfaz grÃ¡fica"],
        correct: 1, // B
        justification: "Los servicios (demonios) funcionan en background sin interfaz de usuario."
    },
    {
        q: "RA3 - Â¿QuÃ© es un socket?",
        options: ["Una direcciÃ³n IP", "Un mecanismo de comunicaciÃ³n entre aplicaciones en red", "Un servicio del sistema", "Un protocolo de transporte"],
        correct: 1, // B
        justification: "Punto final de una conexiÃ³n que permite a las aplicaciones intercambiar datos."
    }
            
        ];

        // --- APP LOGIC ---

        let quizQuestions = [];
        let currentQuestionIndex = 0;
        let score = 0;
        let isAnswered = false;

        const startScreen = document.getElementById('start-screen');
        const quizScreen = document.getElementById('quiz-screen');
        const resultScreen = document.getElementById('result-screen');
        
        const questionText = document.getElementById('question-text');
        const optionsContainer = document.getElementById('options-container');
        const currentQNum = document.getElementById('current-question-num');
        const totalQNum = document.getElementById('total-questions-num');
        const progressContainer = document.getElementById('progress-container');
        const feedbackArea = document.getElementById('feedback-area');
        const feedbackTitle = document.getElementById('feedback-title');
        const feedbackJustification = document.getElementById('feedback-justification');
        const feedbackIcon = document.getElementById('feedback-icon');
        const nextBtn = document.getElementById('next-btn');

        // Shuffle Array Helper
        function shuffle(array) {
            let currentIndex = array.length, randomIndex;
            while (currentIndex != 0) {
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex--;
                [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
            }
            return array;
        }

        // Initialize Quiz
        function startQuiz() {
            // 1. Prepare questions: deep copy
            let questions = JSON.parse(JSON.stringify(rawQuestions));
            
            // 2. Shuffle questions
            questions = shuffle(questions);
            
            // 3. Shuffle options for each question AND update the correct index
            questions.forEach(q => {
                const originalCorrectText = q.options[q.correct]; // Store the text of the correct answer
                q.options = shuffle(q.options); // Shuffle options
                q.correct = q.options.indexOf(originalCorrectText); // Find new index of correct answer
            });

            quizQuestions = questions;
            currentQuestionIndex = 0;
            score = 0;
            
            totalQNum.innerText = quizQuestions.length;
            
            startScreen.classList.add('hidden');
            resultScreen.classList.add('hidden');
            quizScreen.classList.remove('hidden');
            progressContainer.classList.remove('hidden');
            
            renderQuestion();
        }

        function renderQuestion() {
            isAnswered = false;
            const q = quizQuestions[currentQuestionIndex];
            
            // Update Text
            currentQNum.innerText = currentQuestionIndex + 1;
            questionText.innerText = q.q;
            
            // Clear Options & Feedback
            optionsContainer.innerHTML = '';
            feedbackArea.classList.add('hidden');
            
            // Render Options
            q.options.forEach((opt, index) => {
                const btn = document.createElement('button');
                btn.className = `option-card w-full text-left p-4 rounded-xl border-2 border-slate-200 bg-white hover:border-indigo-300 transition-all group flex items-start gap-3`;
                btn.onclick = () => checkAnswer(index, btn);
                
                const letter = String.fromCharCode(65 + index); // A, B, C, D...
                btn.innerHTML = `
                    <span class="flex-shrink-0 w-8 h-8 flex items-center justify-center bg-slate-100 text-slate-600 rounded-full font-bold group-hover:bg-indigo-100 group-hover:text-indigo-600 transition-colors">${letter}</span>
                    <span class="text-slate-700 font-medium pt-1">${opt}</span>
                `;
                optionsContainer.appendChild(btn);
            });
        }

        function checkAnswer(selectedIndex, selectedBtn) {
            if (isAnswered) return;
            isAnswered = true;

            const q = quizQuestions[currentQuestionIndex];
            const isCorrect = selectedIndex === q.correct;
            
            // Highlight Selected
            if (isCorrect) {
                score++;
                selectedBtn.classList.remove('border-slate-200', 'bg-white');
                selectedBtn.classList.add('border-green-500', 'bg-green-50');
                selectedBtn.querySelector('span:first-child').classList.add('bg-green-200', 'text-green-800');
                
                showFeedback(true, q.justification);
            } else {
                selectedBtn.classList.remove('border-slate-200', 'bg-white');
                selectedBtn.classList.add('border-red-500', 'bg-red-50');
                selectedBtn.querySelector('span:first-child').classList.add('bg-red-200', 'text-red-800');
                
                // Highlight Correct One
                const correctBtn = optionsContainer.children[q.correct];
                correctBtn.classList.remove('border-slate-200', 'bg-white');
                correctBtn.classList.add('border-green-500', 'bg-green-50');
                
                showFeedback(false, q.justification);
            }
        }

        function showFeedback(isCorrect, text) {
            feedbackArea.classList.remove('hidden');
            feedbackArea.className = `mt-6 p-4 rounded-lg border flex flex-col ${isCorrect ? 'bg-green-50 border-green-200' : 'bg-red-50 border-red-200'} fade-in`;
            
            feedbackIcon.innerHTML = isCorrect ? '<i class="fas fa-check-circle text-green-600"></i>' : '<i class="fas fa-times-circle text-red-600"></i>';
            feedbackTitle.innerText = isCorrect ? "Â¡Correcto!" : "Incorrecto";
            feedbackTitle.className = `font-bold text-lg ${isCorrect ? 'text-green-800' : 'text-red-800'}`;
            
            feedbackJustification.innerText = text || "Sin justificaciÃ³n disponible.";
            
            // Auto scroll to feedback on mobile
            if(window.innerWidth < 768) {
                feedbackArea.scrollIntoView({ behavior: 'smooth', block: 'end' });
            }
        }

        function nextQuestion() {
            currentQuestionIndex++;
            if (currentQuestionIndex < quizQuestions.length) {
                renderQuestion();
            } else {
                showResult();
            }
        }

        function showResult() {
            quizScreen.classList.add('hidden');
            progressContainer.classList.add('hidden');
            resultScreen.classList.remove('hidden');
            
            const total = quizQuestions.length;
            const percentage = (score / total) * 100;
            
            document.getElementById('final-score').innerText = `${score}/${total}`;
            
            // Animate Bar
            setTimeout(() => {
                document.getElementById('final-progress-bar').style.width = `${percentage}%`;
            }, 100);

            // Icon and Message
            const scoreCircle = document.getElementById('score-circle');
            const scoreMsg = document.getElementById('score-message');
            
            if (percentage >= 90) {
                scoreCircle.className = "w-24 h-24 mx-auto rounded-full flex items-center justify-center text-4xl shadow-lg relative bg-green-100 text-green-600 mb-4";
                scoreCircle.innerHTML = '<i class="fas fa-trophy"></i>';
                scoreMsg.innerText = "Â¡Excelente! Eres un experto en PSP.";
            } else if (percentage >= 70) {
                scoreCircle.className = "w-24 h-24 mx-auto rounded-full flex items-center justify-center text-4xl shadow-lg relative bg-blue-100 text-blue-600 mb-4";
                scoreCircle.innerHTML = '<i class="fas fa-thumbs-up"></i>';
                scoreMsg.innerText = "Â¡Muy bien! Tienes conocimientos sÃ³lidos.";
            } else if (percentage >= 50) {
                scoreCircle.className = "w-24 h-24 mx-auto rounded-full flex items-center justify-center text-4xl shadow-lg relative bg-yellow-100 text-yellow-600 mb-4";
                scoreCircle.innerHTML = '<i class="fas fa-book-reader"></i>';
                scoreMsg.innerText = "Aprobado, pero podrÃ­as repasar un poco mÃ¡s.";
            } else {
                scoreCircle.className = "w-24 h-24 mx-auto rounded-full flex items-center justify-center text-4xl shadow-lg relative bg-red-100 text-red-600 mb-4";
                scoreCircle.innerHTML = '<i class="fas fa-exclamation-triangle"></i>';
                scoreMsg.innerText = "Necesitas estudiar mÃ¡s. Â¡No te rindas!";
            }
        }

        function restartQuiz() {
            startQuiz();
        }
    </script>
</body>

</html>


