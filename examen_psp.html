<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Examen Integral PSP (Fusionado)</title>
    <script src="https://cdn.tailwindcss.com"></script>

    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üìö</text></svg>">
    <script data-goatcounter="https://jrenedo.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>

    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .option-card:hover { transform: translateY(-2px); box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); }
    </style>
</head>
<body class="bg-slate-100 min-h-screen flex items-center justify-center p-4">

    <!-- Main Container -->
    <div class="bg-white rounded-2xl shadow-xl w-full max-w-3xl overflow-hidden min-h-[500px] flex flex-col relative">
        
        <!-- Header -->
        <div class="bg-indigo-600 p-6 text-white flex justify-between items-center z-10">
            <h1 class="text-xl font-bold flex items-center gap-2">
                <i class="fas fa-server"></i> Examen PSP (Completo)
            </h1>
            <div id="progress-container" class="hidden text-sm font-medium bg-indigo-500 px-3 py-1 rounded-full">
                <span id="current-question-num">1</span> / <span id="total-questions-num">0</span>
            </div>
        </div>

        <!-- Content Area -->
        <div class="flex-1 p-6 relative flex flex-col justify-center">
            
            <!-- Start Screen -->
            <div id="start-screen" class="text-center space-y-6 fade-in">
                <div class="w-24 h-24 bg-indigo-100 rounded-full flex items-center justify-center mx-auto text-indigo-600 text-4xl mb-4">
                    <i class="fas fa-clipboard-list"></i>
                </div>
                <h2 class="text-3xl font-bold text-slate-800">Programaci√≥n de Servicios y Procesos</h2>
                <p class="text-slate-600 max-w-md mx-auto">
                    Cuestionario interactivo fusionado. Incluye preguntas del examen integral y del segundo documento (evitando duplicados).
                </p>
                <div class="flex flex-col gap-2 max-w-xs mx-auto">
                    <div class="flex items-center gap-2 text-sm text-slate-500 justify-center">
                        <i class="fas fa-random"></i> 99 Preguntas √∫nicas
                    </div>
                    <div class="flex items-center gap-2 text-sm text-slate-500 justify-center">
                        <i class="fas fa-shuffle"></i> Orden y respuestas aleatorias
                    </div>
                </div>
                <button onclick="startQuiz()" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-8 rounded-full transition-all transform hover:scale-105 shadow-lg mt-4">
                    Comenzar Examen
                </button>
            </div>

            <!-- Quiz Screen -->
            <div id="quiz-screen" class="hidden flex flex-col h-full fade-in">
                <div class="mb-6">
                    <span class="text-xs font-bold text-indigo-600 uppercase tracking-wide mb-1 block">Pregunta</span>
                    <h3 id="question-text" class="text-xl md:text-2xl font-semibold text-slate-800 leading-relaxed">
                        <!-- Question goes here -->
                    </h3>
                </div>

                <div id="options-container" class="grid gap-3 md:grid-cols-1">
                    <!-- Options go here -->
                </div>

                <!-- Feedback / Next Button Area -->
                <div id="feedback-area" class="mt-6 hidden p-4 rounded-lg bg-slate-50 border border-slate-200">
                    <div class="flex items-start gap-3">
                        <div id="feedback-icon" class="text-2xl mt-1"></div>
                        <div>
                            <h4 id="feedback-title" class="font-bold text-lg"></h4>
                            <p id="feedback-justification" class="text-slate-600 mt-1 text-sm leading-relaxed"></p>
                        </div>
                    </div>
                    <div class="mt-4 flex justify-end">
                        <button id="next-btn" onclick="nextQuestion()" class="bg-slate-800 hover:bg-slate-900 text-white font-medium py-2 px-6 rounded-lg transition-colors flex items-center gap-2">
                            Siguiente <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Result Screen -->
            <div id="result-screen" class="hidden text-center space-y-6 fade-in">
                <div class="w-24 h-24 mx-auto rounded-full flex items-center justify-center text-4xl shadow-lg relative" id="score-circle">
                    <!-- Icon handled by JS -->
                </div>
                
                <div>
                    <h2 class="text-3xl font-bold text-slate-800 mb-2">¬°Examen Finalizado!</h2>
                    <p class="text-slate-600">Tu puntuaci√≥n final es:</p>
                </div>

                <div class="text-5xl font-black text-indigo-600 tracking-tight" id="final-score">
                    0/0
                </div>

                <div class="w-full bg-slate-200 rounded-full h-4 max-w-md mx-auto overflow-hidden">
                    <div id="final-progress-bar" class="bg-indigo-600 h-4 rounded-full transition-all duration-1000" style="width: 0%"></div>
                </div>
                
                <p id="score-message" class="text-lg font-medium text-slate-700"></p>

                <button onclick="restartQuiz()" class="bg-white border-2 border-indigo-600 text-indigo-600 hover:bg-indigo-50 font-bold py-3 px-8 rounded-full transition-all transform hover:scale-105 mt-6">
                    <i class="fas fa-redo"></i> Intentar de nuevo
                </button>
            </div>

        </div>
    </div>

    <script>
        // --- DATASET: Merged Questions from PSP1 (58) and PSP (1 unique) ---
        const rawQuestions = [
            {
                q: "Seg√∫n las pr√°cticas de programaci√≥n segura, ¬øc√≥mo deben tratarse los archivos de la aplicaci√≥n para evitar modificaciones externas?",
                options: ["Deben ser archivos ejecutables p√∫blicos.", "Deben tener permisos de escritura total.", "Deben ser siempre archivos ocultos.", "Deben ser de solo lectura."],
                correct: 3, // D
                justification: "El manual indica que los archivos de la aplicaci√≥n deben ser de solo lectura para prevenir que un usuario los modifique malintencionadamente."
            },
            {
                q: "¬øQu√© fase del control de acceso se encarga de verificar fehacientemente que el usuario es quien dice ser (ej. mediante contrase√±a)?",
                options: ["Identificaci√≥n.", "Autorizaci√≥n.", "Autenticaci√≥n.", "Registro."],
                correct: 2, // C
                justification: "La autenticaci√≥n es el proceso donde el sistema comprueba la identidad declarada del usuario."
            },
            {
                q: "¬øC√≥mo se denomina al √∫ltimo paso del control de acceso que ofrece el recurso si el proceso previo fue exitoso?",
                options: ["Autorizaci√≥n.", "Verificaci√≥n.", "Autenticaci√≥n.", "Identificaci√≥n."],
                correct: 0, // A
                justification: "La autorizaci√≥n es la fase final que concede el acceso a la informaci√≥n o recursos tras una autenticaci√≥n positiva."
            },
            {
                q: "¬øQu√© t√©cnica de autenticaci√≥n reduce el factor humano utilizando rasgos como la retina o la huella dactilar?",
                options: ["Cifrado asim√©trico.", "Biometr√≠a.", "Firma digital.", "Certificaci√≥n."],
                correct: 1, // B
                justification: "La biometr√≠a engloba lectores f√≠sicos que ofrecen mayor seguridad al eliminar la vulnerabilidad del factor humano."
            },
            {
                q: "En Java, ¬øqu√© m√©todo de la clase Cipher realiza la operaci√≥n final de encriptaci√≥n o desencriptaci√≥n de los datos?",
                options: ["init().", "update().", "doFinal().", "getInstance()."],
                correct: 2, // C
                justification: "El m√©todo doFinal() es el encargado de ejecutar la transformaci√≥n criptogr√°fica final sobre los datos."
            },
            {
                q: "¬øCu√°l es la funci√≥n principal de las tres condiciones de Bernstein?",
                options: ["Determinar si dos instrucciones pueden ejecutarse concurrentemente.", "Generar claves p√∫blicas y privadas para RSA.", "Establecer un t√∫nel seguro mediante SSH.", "Sincronizar hilos mediante el uso de monitores."],
                correct: 0, // A
                justification: "Bernstein estableci√≥ condiciones de intersecci√≥n vac√≠a entre conjuntos de lectura y escritura para permitir la ejecuci√≥n simult√°nea."
            },
            {
                q: "¬øQu√© t√©cnica divide un problema grande en partes peque√±as para resolverlas simult√°neamente en equipos multiprocesadores?",
                options: ["Programaci√≥n distribuida.", "Programaci√≥n paralela.", "Programaci√≥n iterativa.", "Programaci√≥n monohilo."],
                correct: 1, // B
                justification: "La programaci√≥n paralela ejecuta muchas instrucciones a la vez dividiendo problemas de grandes dimensiones."
            },
            {
                q: "¬øQu√© define a los archivos ejecutables desde el punto de vista del sistema operativo?",
                options: ["Son archivos de texto con el c√≥digo fuente original.", "Son carpetas que contienen exclusivamente librer√≠as Java.", "Son archivos binarios con instrucciones en lenguaje m√°quina.", "Son procesos que requieren siempre una interfaz gr√°fica."],
                correct: 2, // C
                justification: "Los ejecutables contienen el c√≥digo fuente ya traducido por el compilador para ser entendido directamente por el microprocesador."
            },
            {
                q: "¬øQu√© caracter√≠stica define espec√≠ficamente a un 'servicio'?",
                options: ["Se ejecuta en segundo plano y carece de interfaz gr√°fica.", "Es controlado permanentemente por el usuario de forma directa.", "Finaliza inmediatamente tras su primera instrucci√≥n.", "Solo puede ejecutarse en sistemas monohilo."],
                correct: 0, // A
                justification: "Los servicios son procesos que funcionan en segundo plano, destinados a tareas de mantenimiento o procesos continuos sin interacci√≥n directa."
            },
            {
                q: "¬øQu√© funci√≥n se utiliza espec√≠ficamente en sistemas Windows para solicitar la creaci√≥n de un nuevo proceso?",
                options: ["fork().", "createProcess().", "new Thread().", "start()."],
                correct: 1, // B
                justification: "Mientras que en Linux se usa fork(), en Windows la funci√≥n nativa es createProcess()."
            },
            {
                q: "¬øQu√© efecto tiene invocar el m√©todo sleep() sobre un proceso o hilo?",
                options: ["Detiene su ejecuci√≥n de forma permanente.", "Pausa el hilo durante una cantidad determinada de milisegundos.", "Termina el m√©todo run() de forma ordenada.", "Despierta a todos los hilos que est√°n en espera."],
                correct: 1, // B
                justification: "El m√©todo sleep() detiene la ejecuci√≥n del hilo actual por el tiempo especificado en sus par√°metros."
            },
            {
                q: "Al comparar hilos y procesos, ¬øcu√°l es una ventaja competitiva fundamental de los hilos?",
                options: ["Los hilos no comparten memoria entre s√≠.", "Son totalmente independientes del proceso que los cre√≥.", "Tienen un menor coste de creaci√≥n y cambio de contexto.", "Requieren una mayor reserva de recursos del sistema operativo."],
                correct: 2, // C
                justification: "Crear un hilo es m√°s r√°pido y econ√≥mico en recursos que crear un proceso debido a que comparten memoria."
            },
            {
                q: "¬øQu√© m√©todo se utiliza para despertar hilos bloqueados y NO para detener el hilo actual?",
                options: ["notify().", "wait().", "sleep().", "suspend()."],
                correct: 0, // A
                justification: "Mientras wait o sleep bloquean el hilo, notify se usa para enviar una se√±al de reactivaci√≥n a otros hilos."
            },
            {
                q: "¬øEn qu√© momento se considera que un hilo ha pasado definitivamente al estado 'Muerto'?",
                options: ["Cuando invoca el m√©todo yield().", "Cuando finaliza la ejecuci√≥n de su m√©todo run().", "Cuando se bloquea por una operaci√≥n de entrada/salida.", "Al entrar en una secci√≥n cr√≠tica synchronized."],
                correct: 1, // B
                justification: "Un hilo muere al terminar sus instrucciones en el m√©todo run() o por una parada externa."
            },
            {
                q: "¬øEn qu√© capa del modelo TCP/IP se ubican protocolos como HTTP, FTP y DNS?",
                options: ["Capa de Internet.", "Capa de Transporte.", "Capa de Aplicaci√≥n.", "Capa de Red."],
                correct: 2, // C
                justification: "La capa de aplicaci√≥n maneja protocolos de alto nivel que implementan servicios para el usuario."
            },
            {
                q: "¬øQu√© mecanismo permite la comunicaci√≥n entre aplicaciones abstrayendo al usuario de las capas inferiores?",
                options: ["Sockets.", "RMI.", "DatagramPacket.", "Tuber√≠as."],
                correct: 0, // A
                justification: "Un socket crea un canal de comunicaci√≥n entre aplicaciones a trav√©s de la red simplificando el intercambio."
            },
            {
                q: "¬øQu√© protocolo de transporte se caracteriza por ser orientado a conexi√≥n y fiable?",
                options: ["UDP.", "TCP.", "IP.", "ICMP."],
                correct: 1, // B
                justification: "TCP asegura la entrega ordenada y fiable de paquetes mediante una conexi√≥n previa."
            },
            {
                q: "En la programaci√≥n de sockets, ¬øqu√© m√©todo vincula el socket a una direcci√≥n IP y puerto local?",
                options: ["connect().", "accept().", "bind().", "listen()."],
                correct: 2, // C
                justification: "El m√©todo bind() realiza el enlazamiento del socket a una direcci√≥n y puerto determinados."
            },
            {
                q: "¬øQu√© funci√≥n de ServerSocket bloquea la ejecuci√≥n esperando una petici√≥n de conexi√≥n entrante?",
                options: ["bind().", "accept().", "read().", "close()."],
                correct: 1, // B
                justification: "El m√©todo accept() detiene al servidor hasta que recibe y acepta la conexi√≥n de un cliente."
            },
            {
                q: "¬øQu√© protocolo permite asignar din√°micamente direcciones IP a los clientes de una red?",
                options: ["DNS.", "DHCP.", "SMTP.", "NFS."],
                correct: 1, // B
                justification: "El servidor configurado con DHCP asigna IPs de forma autom√°tica a los dispositivos que se conectan."
            },
            {
                q: "¬øCu√°ndo es aconsejable utilizar un servidor concurrente en lugar de uno iterativo?",
                options: ["Cuando solo se atiende una petici√≥n cada vez.", "Cuando hay una gran cantidad de peticiones simult√°neas.", "Si el coste de recursos es muy elevado para procesos cortos.", "Cuando se utiliza exclusivamente el protocolo UDP."],
                correct: 1, // B
                justification: "Los servidores concurrentes permiten atender a m√∫ltiples clientes a la vez mediante hilos."
            },
            {
                q: "¬øQu√© t√©cnica es conceptualmente parecida a RMI pero basada en programaci√≥n estructurada?",
                options: ["SOAP.", "RPC (Remote Procedure Call).", "REST.", "TCP."],
                correct: 1, // B
                justification: "El RPC es la variante estructurada para invocar procedimientos remotos, similar al RMI orientado a objetos."
            },
            {
                q: "¬øQu√© herramienta distribuye las peticiones masivas entre servidores para evitar colapsos?",
                options: ["Servidor dedicado.", "Balanceadores de carga.", "R√©plicas de servidores.", "Monitorizaci√≥n."],
                correct: 1, // B
                justification: "Los balanceadores distribuyen la carga de tr√°fico masivo para optimizar rendimiento."
            },
            {
                q: "¬øC√≥mo se denomina al equipo inform√°tico que es √∫nico para una empresa y no se comparte?",
                options: ["Servidor compartido.", "Servidor espejo.", "Servidor dedicado.", "Servidor concurrente."],
                correct: 2, // C
                justification: "Un servidor dedicado es aquel recurso √∫nico para una organizaci√≥n."
            },
            {
                q: "¬øCu√°ntos bits genera un resumen mediante el algoritmo hash MD5?",
                options: ["160 bits.", "128 bits.", "256 bits.", "64 bits."],
                correct: 1, // B
                justification: "El algoritmo MD5 genera res√∫menes de longitud fija de 128 bits."
            },
            {
                q: "La seguridad del algoritmo RSA se basa en la dificultad de resolver:",
                options: ["La sustituci√≥n de caracteres.", "La factorizaci√≥n de n√∫meros enteros.", "La exclusi√≥n mutua.", "La condici√≥n de carrera."],
                correct: 1, // B
                justification: "RSA utiliza pares de n√∫meros hallados mediante operaciones con n√∫meros primos grandes."
            },
            {
                q: "¬øQu√© puerto utiliza habitualmente el protocolo SSH?",
                options: ["80.", "443.", "22.", "21."],
                correct: 2, // C
                justification: "El puerto est√°ndar para la comunicaci√≥n segura mediante el int√©rprete de √≥rdenes seguro es el 22."
            },
            {
                q: "¬øQu√© problema ocurre cuando dos procesos se bloquean esperando recursos que el otro retiene?",
                options: ["Inanici√≥n.", "Exclusi√≥n mutua.", "Abrazo mortal (Deadlock).", "Inconsistencia."],
                correct: 2, // C
                justification: "El deadlock es el interbloqueo mutuo entre procesos por dependencia de recursos."
            },
            {
                q: "¬øQu√© comando de Linux muestra los procesos activos detallando el UID y el PID?",
                options: ["ls -l.", "ps -f.", "renice.", "taskset."],
                correct: 1, // B
                justification: "El comando ps -f es el encargado de listar los procesos activos con su informaci√≥n t√©cnica."
            },
            {
                q: "¬øCu√°l es el rango de prioridad de un hilo en el lenguaje Java?",
                options: ["Entre 1 y 10.", "Entre 0 y 100.", "Entre -20 y 20.", "Entre 1 y 5."],
                correct: 0, // A
                justification: "Java utiliza un rango de 1 (MIN_PRIORITY) a 10 (MAX_PRIORITY)."
            },
            {
                q: "¬øQu√© mensaje inicia el 'Three-way handshake' en una conexi√≥n TCP?",
                options: ["ACK.", "FIN.", "SYN.", "SYN-ACK."],
                correct: 2, // C
                justification: "El cliente solicita la conexi√≥n enviando el mensaje de sincronizaci√≥n SYN."
            },
            {
                q: "¬øQu√© lenguaje utiliza obligatoriamente el protocolo SOAP para sus mensajes?",
                options: ["JSON.", "HTML.", "XML.", "Texto plano."],
                correct: 2, // C
                justification: "SOAP define la comunicaci√≥n de objetos mediante el lenguaje XML."
            },
            {
                q: "¬øCu√°les son las operaciones est√°ndares de los servicios web REST?",
                options: ["SYN, ACK, FIN.", "POST, GET, PUT y DELETE.", "START, RUN, STOP.", "BIND, ACCEPT, SEND."],
                correct: 1, // B
                justification: "REST basa su uso en los verbos est√°ndar de HTTP."
            },
            {
                q: "¬øQu√© librer√≠a externa de Java se usa habitualmente para clientes FTP?",
                options: ["Java Standard API.", "Apache Commons Net.", "Google Guava.", "RMI Registry."],
                correct: 1, // B
                justification: "Esta librer√≠a proporciona clases como FTPClient para la gesti√≥n de transferencias."
            },
            {
                q: "¬øC√≥mo se denomina a un proceso finalizado que a√∫n no ha liberado sus recursos en Unix?",
                options: ["Hu√©rfano.", "Zombie.", "Activo.", "Bloqueado."],
                correct: 1, // B
                justification: "Los procesos zombies han terminado su ejecuci√≥n pero mantienen su entrada en la tabla de procesos."
            },
            {
                q: "¬øQu√© palabra clave de Java evita que varios hilos usen a la vez un recurso compartido?",
                options: ["volatile.", "synchronized.", "static.", "final."],
                correct: 1, // B
                justification: "synchronized bloquea el acceso de otros hilos al objeto marcado hasta que el actual termina."
            },
            {
                q: "¬øQu√© clase de Java representa una direcci√≥n IP?",
                options: ["URL.", "InetAddress.", "Socket.", "ServerSocket."],
                correct: 1, // B
                justification: "InetAddress es la clase espec√≠fica del API de Java para representar IPs."
            },
            {
                q: "La capacidad de contar con servidores r√©plica para evitar interrupciones se conoce como:",
                options: ["Balanceo de carga.", "Alta disponibilidad.", "Programaci√≥n paralela.", "Encadenamiento."],
                correct: 1, // B
                justification: "La alta disponibilidad garantiza un servicio cercano al 100% mediante r√©plicas activas."
            },
            {
                q: "¬øQu√© puerto utiliza el protocolo HTTPS por defecto?",
                options: ["80.", "22.", "443.", "21."],
                correct: 2, // C
                justification: "HTTPS a√±ade seguridad a HTTP utilizando el puerto 443."
            },
            {
                q: "¬øQu√© servicio asegura que un emisor no pueda negar haber enviado un mensaje?",
                options: ["Confidencialidad.", "No repudio en origen.", "Disponibilidad.", "Integridad."],
                correct: 1, // B
                justification: "El no repudio en origen aporta pruebas de que el emisor envi√≥ el mensaje."
            },
            {
                q: "¬øQu√© m√©todo inicializa e inicia realmente la ejecuci√≥n de un hilo en Java?",
                options: ["start().", "run().", "init().", "execute()."],
                correct: 0, // A
                justification: "El m√©todo start() crea el hilo y llama autom√°ticamente al m√©todo run()."
            },
            {
                q: "¬øEn qu√© nivel del modelo TCP/IP se realiza la divisi√≥n del mensaje en paquetes?",
                options: ["Nivel de aplicaci√≥n.", "Nivel de transporte.", "Nivel de Internet.", "Nivel de red."],
                correct: 1, // B
                justification: "El nivel de transporte es el encargado de segmentar la informaci√≥n en paquetes para el env√≠o."
            },
            {
                q: "Para una programaci√≥n segura: un c√≥digo limpio aporta seguridad, la reutilizaci√≥n debe ser de c√≥digo revisado y se debe eliminar el c√≥digo obsoleto. ¬øEs correcto?",
                options: ["S√≠, todas son pr√°cticas recomendadas.", "No, el c√≥digo obsoleto no afecta.", "No, no se debe reutilizar nunca c√≥digo.", "S√≠, pero solo si es c√≥digo Java."],
                correct: 0, // A
                justification: "Son principios fundamentales para evitar confusiones y vulnerabilidades en la aplicaci√≥n."
            },
            {
                q: "¬øQu√© informaci√≥n se considera 'sensible' en una base de datos?",
                options: ["Solo la contrase√±a.", "Solo el DNI.", "Solo la direcci√≥n f√≠sica.", "Contrase√±a, DNI y direcci√≥n f√≠sica (todas las anteriores)."],
                correct: 3, // D
                justification: "Se considera sensible cualquier informaci√≥n privada del usuario."
            },
            {
                q: "¬øQu√© informaci√≥n mantiene un hilo como contexto propio e independiente dentro del proceso?",
                options: ["Claves criptogr√°ficas.", "Identificador, pila y contador de programa.", "C√≥digo fuente y datos globales.", "Recursos compartidos del sistema operativo."],
                correct: 1, // B
                justification: "Aunque comparten datos del proceso, los hilos tienen su propia pila y registro contador."
            },
            {
                q: "¬øQu√© identifica de forma completa y √∫nica una conexi√≥n TCP?",
                options: ["Solo la IP del servidor.", "El protocolo HTTP.", "IP origen, IP destino y los puertos de ambos.", "El nombre del host cliente."],
                correct: 2, // C
                justification: "Un socket TCP se define por el conjunto (IP, puerto) de ambos extremos."
            },
            {
                q: "¬øCu√°l es el objetivo principal de la planificaci√≥n de procesos del sistema operativo?",
                options: ["Eliminar procesos inactivos permanentemente.", "Asignar memoria RAM de forma est√°tica.", "Decidir qu√© proceso usa la CPU en cada momento.", "Compilar los archivos ejecutables."],
                correct: 2, // C
                justification: "El planificador gestiona el reparto del tiempo de procesador entre los procesos preparados."
            },
            {
                q: "¬øQu√© ocurre cuando un hilo modifica un dato compartido en la memoria del proceso?",
                options: ["Los dem√°s hilos del mismo proceso pueden ver el cambio.", "El cambio se pierde si el hilo no lo guarda en disco.", "El sistema operativo bloquea el hilo inmediatamente.", "Se crea una copia privada para el resto de hilos."],
                correct: 0, // A
                justification: "Los hilos comparten la secci√≥n de datos del proceso padre."
            },
            {
                q: "¬øQu√© define fundamentalmente a un protocolo criptogr√°fico?",
                options: ["Un lenguaje de programaci√≥n nuevo.", "Reglas para la seguridad en la comunicaci√≥n de sistemas.", "Un algoritmo de compresi√≥n de datos.", "Un tipo de sistema operativo seguro."],
                correct: 1, // B
                justification: "Especifican c√≥mo utilizar algoritmos para establecer claves, autenticar entidades, etc."
            },
            {
                q: "¬øCu√°l es el inconveniente principal de UDP frente a TCP?",
                options: ["Es mucho m√°s lento en transferencia.", "Requiere una conexi√≥n previa muy pesada.", "No garantiza la entrega de los mensajes.", "No permite enviar paquetes de datos."],
                correct: 2, // C
                justification: "UDP es un protocolo no fiable porque no realiza acuse de recibo ni ordenamiento."
            },
            {
                q: "¬øQu√© herramienta permite supervisar el estado de disponibilidad inmediata de un servicio?",
                options: ["Editor de c√≥digo.", "Compilador.", "Herramientas de monitorizaci√≥n.", "Depurador."],
                correct: 2, // C
                justification: "Los administradores usan herramientas de monitorizaci√≥n para realizar acciones de mantenimiento inmediatas."
            },
            {
                q: "¬øQu√© clase de Java permite al servidor aceptar espec√≠ficamente conexiones TCP entrantes?",
                options: ["ServerSocket.", "URL.", "DatagramPacket.", "HttpURLConnection."],
                correct: 0, // A
                justification: "ServerSocket es la clase que escucha en un puerto peticiones de clientes TCP."
            },
            {
                q: "¬øQu√© componente documenta el cat√°logo de funciones accesibles de un servicio para desarrolladores?",
                options: ["BCP.", "API.", "RMI.", "Socket."],
                correct: 1, // B
                justification: "Una API proporciona los m√©todos y par√°metros definidos para interactuar con un software."
            },
            {
                q: "¬øQu√© tipo de criptograf√≠a utiliza una √∫nica clave compartida para cifrar y descifrar?",
                options: ["Criptograf√≠a asim√©trica.", "Criptograf√≠a sim√©trica.", "Funci√≥n Hash.", "Firma digital."],
                correct: 1, // B
                justification: "En la sim√©trica, emisor y receptor comparten la misma clave secreta."
            },
            {
                q: "En el modelo cliente-servidor, ¬øqu√© rol es el encargado de iniciar normalmente la comunicaci√≥n?",
                options: ["El servidor.", "El cliente.", "El router.", "El firewall."],
                correct: 1, // B
                justification: "Los clientes realizan las peticiones iniciales y los servidores responden."
            },
            {
                q: "¬øQu√© funci√≥n tienen los puntos de interrupci√≥n (breakpoints) en el desarrollo?",
                options: ["Muestran valores para comprobar que los datos son correctos.", "Determinan si el depurador debe parar la ejecuci√≥n en un punto.", "Permiten verificar la trazabilidad de la aplicaci√≥n.", "Todas las respuestas son correctas."],
                correct: 3, // D
                justification: "Se usan como herramientas de depuraci√≥n para analizar el estado del programa en puntos cr√≠ticos."
            },
            {
                q: "Seg√∫n los casos pr√°cticos, ¬øqu√© algoritmo se utiliza en Java para cifrar una variable 'Mensaje' en modo ECB?",
                options: ["RSA.", "MD5.", "AES.", "SHA-256."],
                correct: 2, // C
                justification: "El caso pr√°ctico 2 requiere programar una clase usando AES/ECB para cifrado."
            },
            {
                q: "En Linux, ¬øqu√© instrucci√≥n permite cambiar la prioridad de un proceso que ya est√° en ejecuci√≥n?",
                options: ["nice.", "renice.", "taskset.", "ps -l."],
                correct: 1, // B
                justification: "nice se usa al iniciar un proceso, mientras que renice modifica la prioridad de uno ya existente."
            },
            {
                q: "¬øQu√© t√©cnica se utiliza para dividir un mensaje en paquetes en el nivel de transporte del modelo TCP/IP?",
                options: ["Encapsulaci√≥n.", "Fragmentaci√≥n en paquetes.", "Handshake.", "Invocaci√≥n remota."],
                correct: 1, // B
                justification: "La fragmentaci√≥n o segmentaci√≥n ocurre en el nivel de transporte para dividir el mensaje en unidades manejables."
            },
            {
        q: "¬øQu√© m√©todo est√°tico de la clase Cipher se utiliza para crear una instancia del objeto especificando el algoritmo de cifrado (ej: 'AES/ECB/PKCS5Padding')?",
        options: ["Cipher.init()", "Cipher.getInstance()", "Cipher.create()", "Cipher.update()"],
        correct: 1, // B
        justification: "El m√©todo getInstance() es el encargado de instanciar la clase Cipher con la transformaci√≥n solicitada para poder usarla."
    },
    {
        q: "Seg√∫n el protocolo TCP, ¬øcu√°l es la secuencia correcta de mensajes para cerrar una conexi√≥n (Handshake de fin)?",
        options: ["El cliente env√≠a FIN y la conexi√≥n se corta inmediatamente.", "Secuencia de 4 pasos: FIN (Cliente) -> ACK (Servidor) -> FIN (Servidor) -> ACK (Cliente).", "El servidor env√≠a RST al cliente para finalizar.", "El cliente env√≠a un paquete STOP y espera confirmaci√≥n."],
        correct: 1, // B
        justification: "El cierre ordenado requiere que ambos extremos confirmen el fin: primero uno env√≠a FIN y recibe ACK, luego el otro env√≠a su FIN y recibe su ACK."
    },
    {
        q: "¬øQu√© protocolo de la capa de aplicaci√≥n es el est√°ndar utilizado para el env√≠o y transferencia de correo electr√≥nico?",
        options: ["POP3.", "IMAP.", "SMTP.", "HTTP."],
        correct: 2, // C
        justification: "SMTP (Simple Mail Transfer Protocol) es el protocolo dise√±ado para el intercambio y env√≠o de correos, mientras que POP3/IMAP son para la recepci√≥n."
    },
            {
        q: "Seg√∫n el solucionario del libro, ¬øqu√© ventaja principal ofrece REST frente a SOAP en comunicaciones simult√°neas?",
        options: [
            "REST utiliza un cifrado m√°s potente que SOAP.",
            "Los mensajes enviados definen todo lo necesario para procesarse, por lo que el servidor no necesita almacenar el estado (Stateless).",
            "REST permite el uso de protocolos de transporte distintos a HTTP.",
            "SOAP no permite el env√≠o de datos binarios."
        ],
        correct: 1, // B
        justification: "Texto literal del solucionario (5.5): 'Los mensajes definen todo lo necesario... por lo que ni cliente ni servidor deben almacenar el estado'."
    },
    {
        q: "¬øQu√© m√©todo de la clase Thread devuelve la REFERENCIA al objeto hilo que se est√° ejecutando actualmente (no su ID)?",
        options: [
            "long getId()",
            "static Thread currentThread()",
            "void interrupt()",
            "String getName()"
        ],
        correct: 1, // B
        justification: "Cuidado con la trampa: getId() devuelve un n√∫mero (long), pero currentThread() devuelve la referencia al propio objeto (Thread) en ejecuci√≥n."
    },
    {
        q: "¬øQu√© elementos identifican de forma COMPLETA y √∫nica una conexi√≥n de socket establecida entre dos m√°quinas?",
        options: [
            "Solo la IP y puerto del servidor.",
            "La IP de origen y la IP de destino √∫nicamente.",
            "Protocolo, IP origen, Puerto origen, IP destino y Puerto destino.",
            "El nombre de dominio y la direcci√≥n MAC."
        ],
        correct: 2, // C
        justification: "Aunque un socket local es IP:Puerto, la conexi√≥n completa (el t√∫nel) se identifica por los 5 valores: Protocolo + IP/Puerto de ambos extremos."
    },
    {
        q: "En las condiciones de Bernstein, si la intersecci√≥n entre el Conjunto de Lectura 1 (L1) y el Conjunto de Lectura 2 (L2) es vac√≠a, ¬øpodemos asegurar que hay concurrencia?",
        options: [
            "S√≠, porque no comparten datos le√≠dos.",
            "No, porque las condiciones de Bernstein solo comparan Escritura vs Lectura o Escritura vs Escritura.",
            "S√≠, es la condici√≥n principal de Bernstein.",
            "No, porque siempre debe haber intersecci√≥n en las lecturas."
        ],
        correct: 1, // B
        justification: "Pregunta trampa: Dos procesos pueden leer lo mismo a la vez sin problemas. Bernstein se centra en conflictos de modificaci√≥n (Escritura). Saber solo L1 y L2 no determina si hay conflicto de escritura."
    },
    {
        q: "¬øCu√°l es la consecuencia funcional principal de NO utilizar hilos (servidor iterativo) en un servidor web?",
        options: [
            "El servidor consume m√°s memoria RAM.",
            "Solo se puede atender una √∫nica petici√≥n a la vez (de forma secuencial).",
            "El c√≥digo es mucho m√°s complejo de mantener.",
            "No se pueden utilizar sockets TCP."
        ],
        correct: 1, // B
        justification: "Aunque los hilos ahorran recursos, la raz√≥n funcional de usarlos es que un servidor 'sin hilos' (iterativo) bloquea a todos los usuarios hasta que termina con el primero."
    },
            {
        q: "¬øCu√°l de las siguientes NO es una de las tres condiciones de Bernstein necesarias para que dos procesos (P1 y P2) puedan ejecutarse concurrentemente?",
        options: [
            "L(P1) ‚à© E(P2) = √ò (Intersecci√≥n vac√≠a entre Lectura de 1 y Escritura de 2).",
            "E(P1) ‚à© L(P2) = √ò (Intersecci√≥n vac√≠a entre Escritura de 1 y Lectura de 2).",
            "E(P1) ‚à© E(P2) = √ò (Intersecci√≥n vac√≠a entre Escrituras de ambos).",
            "L(P1) ‚à© L(P2) = √ò (Intersecci√≥n vac√≠a entre Lecturas de ambos)."
        ],
        correct: 3, // D
        justification: "Bernstein NO proh√≠be que dos procesos lean la misma variable a la vez. El conflicto solo existe si al menos uno de ellos escribe (modifica) el dato."
    },
    {
        q: "En la notaci√≥n de las condiciones de Bernstein, ¬øqu√© representa habitualmente el conjunto E(Pi)?",
        options: [
            "El conjunto de variables de Entrada (Lectura).",
            "El conjunto de Errores del proceso.",
            "El conjunto de variables de Escritura (Salida/Modificaci√≥n).",
            "El conjunto de Estados del proceso."
        ],
        correct: 2, // C
        justification: "E(Pi) o W(Pi) representa el conjunto de Escritura (Write/Output), es decir, las variables que el proceso va a alterar durante su ejecuci√≥n."
    },
    {
        q: "Si se cumplen las tres condiciones de Bernstein entre dos procesos, ¬øqu√© propiedad importante se garantiza?",
        options: [
            "Que los procesos se ejecutar√°n m√°s r√°pido.",
            "El determinismo: el resultado final ser√° el mismo independientemente de si se ejecutan secuencial o concurrentemente.",
            "Que no habr√° interbloqueos (Deadlocks) bajo ninguna circunstancia.",
            "Que el sistema operativo asignar√° m√°s prioridad a estos procesos."
        ],
        correct: 1, // B
        justification: "El objetivo de Bernstein es garantizar que la ejecuci√≥n paralela no corrompa los datos, asegurando que el resultado sea determinista (igual que si fueran uno detr√°s de otro)."
    },
            {
        q: "RA2 - ¬øQu√© estado tiene un hilo creado pero a√∫n no ejecutado?",
        options: ["Muerto", "Bloqueado", "Ejecuci√≥n", "Listo"],
        correct: 3, // D - Listo
        justification: "Estado del ciclo de vida: el hilo ha sido creado y est√° a la espera de que el planificador le asigne la CPU."
    },
    {
        q: "RA1 - ¬øQu√© es un proceso en un sistema operativo?",
        options: ["Un hilo independiente del hardware", "Un programa en ejecuci√≥n gestionado por el sistema operativo", "Un archivo ejecutable almacenado en disco", "Un servicio exclusivo del usuario"],
        correct: 1, // B - Un programa en ejecuci√≥n...
        justification: "Definici√≥n literal: Un proceso es un programa din√°mico en ejecuci√≥n, a diferencia del archivo est√°tico en disco."
    },
    {
        q: "RA1 - ¬øQu√© elemento permite ejecutar tareas de forma concurrente dentro de un proceso?",
        options: ["Servicios", "Ejecutables", "Hilos", "Drivers"],
        correct: 2, // C - Hilos
        justification: "Los hilos (threads) son las unidades que comparten los recursos del proceso padre para trabajar simult√°neamente."
    },
    {
        q: "RA5 - ¬øQu√© pr√°ctica mejora la seguridad del c√≥digo?",
        options: ["Evitar revisiones", "Validar los datos de entrada", "Usar solo bajo nivel", "Reutilizar c√≥digo obsoleto"],
        correct: 1, // B - Validar los datos...
        justification: "La validaci√≥n de inputs es fundamental para evitar inyecciones y errores no controlados."
    },
    {
        q: "RA1 - ¬øQu√© ocurre si dos procesos acceden sin control a un recurso compartido?",
        options: ["Los procesos se detienen", "El sistema siempre lo evita autom√°ticamente", "Se crea un nuevo hilo", "Pueden producirse inconsistencias"],
        correct: 3, // D - Pueden producirse inconsistencias
        justification: "Sin mecanismos de sincronizaci√≥n (como sem√°foros o monitores), los datos pueden corromperse (condici√≥n de carrera)."
    },
    {
        q: "RA5 - ¬øQu√© elemento es clave en protocolos criptogr√°ficos?",
        options: ["Gesti√≥n de hilos", "Balanceo de carga", "Planificaci√≥n de procesos", "Establecimiento de claves"],
        correct: 3, // D - Establecimiento de claves
        justification: "Los protocolos seguros definen c√≥mo se generan, intercambian y establecen las claves para el cifrado."
    },
            // --- PREGUNTAS LITERALES DEL MODELO DE EXAMEN ---
    {
        q: "RA1 - ¬øQu√© estado indica que un proceso est√° usando la CPU?",
        options: ["Bloqueado", "Ejecuci√≥n", "Listo", "Terminado"],
        correct: 1, // B
        justification: "El proceso en ejecuci√≥n es el que tiene el control del procesador en ese instante."
    },
    {
        q: "RA4 - ¬øQu√© tecnolog√≠a permite invocar m√©todos remotos en Java?",
        options: ["RMI", "FTP", "DNS", "HTTP"],
        correct: 0, // A
        justification: "RMI (Remote Method Invocation) permite llamar a m√©todos de objetos en otras m√°quinas virtuales."
    },
    {
        q: "RA3 - ¬øQu√© rol inicia normalmente la comunicaci√≥n en red?",
        options: ["Router", "Servidor", "Cliente", "Firewall"],
        correct: 2, // C
        justification: "El cliente es quien solicita el inicio de la conexi√≥n hacia el servidor."
    },
    {
        q: "RA3 - ¬øQu√© clase Java permite aceptar conexiones entrantes?",
        options: ["DatagramSocket", "URL", "ServerSocket", "Socket"],
        correct: 2, // C
        justification: "ServerSocket se utiliza en el lado servidor para esperar y aceptar peticiones."
    },
    {
        q: "RA1 - ¬øQu√© objetivo tiene la planificaci√≥n de procesos?",
        options: ["Decidir qu√© proceso usa la CPU en cada momento", "Compilar los ejecutables", "Eliminar procesos inactivos", "Asignar memoria permanente a los procesos"],
        correct: 0, // A
        justification: "El planificador del SO decide los turnos de uso del procesador."
    },
    {
        q: "RA5 - ¬øQu√© define un protocolo criptogr√°fico?",
        options: ["Un algoritmo aislado", "Un sistema operativo", "Un lenguaje de programaci√≥n", "Reglas para comunicaciones seguras"],
        correct: 3, // D
        justification: "Conjunto de reglas que gobiernan el intercambio seguro de informaci√≥n."
    },
    {
        q: "RA5 - ¬øQu√© pr√°ctica es segura al trabajar con archivos?",
        options: ["Abrirlos en modo escritura siempre", "Ejecutarlos desde la app", "Controlar permisos de acceso", "Usar rutas absolutas p√∫blicas"],
        correct: 2, // C
        justification: "La restricci√≥n de permisos es b√°sica para la seguridad de la informaci√≥n."
    },
    {
        q: "RA2 - ¬øQu√© m√©todo pausa un hilo durante un tiempo determinado?",
        options: ["stop()", "sleep()", "notify()", "wait()"],
        correct: 1, // B
        justification: "sleep() detiene la ejecuci√≥n el tiempo especificado en milisegundos."
    },
    {
        q: "RA4 - ¬øQu√© protocolo utiliza XML para servicios web?",
        options: ["SOAP", "UDP", "RPC", "REST"],
        correct: 0, // A
        justification: "SOAP utiliza exclusivamente XML para el formato de sus mensajes."
    },
    {
        q: "RA4 - ¬øQu√© caracteriza a un servidor concurrente?",
        options: ["No usa hilos", "Atiende varias peticiones a la vez", "Usa solo UDP", "Atiende una petici√≥n cada vez"],
        correct: 1, // B
        justification: "Utiliza hilos o procesos hijos para gestionar m√∫ltiples clientes simult√°neamente."
    },
    {
        q: "RA1 - ¬øQu√© caracter√≠stica define a un servicio del sistema?",
        options: ["Solo se inicia manualmente", "Se ejecuta en segundo plano sin interacci√≥n directa del usuario", "Finaliza tras una √∫nica ejecuci√≥n", "Siempre requiere interfaz gr√°fica"],
        correct: 1, // B
        justification: "Los servicios (demonios) funcionan en background sin interfaz de usuario."
    },
    {
        q: "RA3 - ¬øQu√© es un socket?",
        options: ["Una direcci√≥n IP", "Un mecanismo de comunicaci√≥n entre aplicaciones en red", "Un servicio del sistema", "Un protocolo de transporte"],
        correct: 1, // B
        justification: "Punto final de una conexi√≥n que permite a las aplicaciones intercambiar datos."
    },
            {
        q: "RA5 - ¬øQu√© objetivo tiene la programaci√≥n segura?",
        options: ["Aumentar el tama√±o del c√≥digo", "Eliminar la reutilizaci√≥n", "Proteger datos y aplicaciones", "Evitar el uso de librer√≠as"],
        correct: 2, // C
        justification: "El objetivo fundamental es garantizar la confidencialidad, integridad y disponibilidad, protegiendo los datos y la l√≥gica de la aplicaci√≥n."
    },
    {
        q: "RA5 - ¬øQu√© criptograf√≠a utiliza una sola clave?",
        options: ["Clave sim√©trica", "Hash", "Clave p√∫blica", "Biom√©trica"],
        correct: 0, // A
        justification: "La criptograf√≠a sim√©trica utiliza la misma clave tanto para cifrar como para descifrar (clave compartida)."
    },
    {
        q: "RA4 - ¬øQu√© componente documenta funciones accesibles de un servicio?",
        options: ["Balanceador", "Switch", "API", "Servidor dedicado"],
        correct: 2, // C
        justification: "Una API (Interfaz de Programaci√≥n de Aplicaciones) define y documenta c√≥mo interactuar con el servicio."
    },
    {
        q: "RA5 - ¬øQu√© fase concede acceso a recursos tras verificar identidad?",
        options: ["Identificaci√≥n", "Registro", "Autenticaci√≥n", "Autorizaci√≥n"],
        correct: 3, // D
        justification: "Una vez autenticado (sabemos qui√©n eres), la Autorizaci√≥n es la fase que determina qu√© puedes hacer o tocar."
    },
    {
        q: "RA1 - ¬øQu√© herramienta permite monitorizar procesos en ejecuci√≥n?",
        options: ["Editor de texto", "IDE", "Administrador de tareas", "Compilador"],
        correct: 2, // C
        justification: "El Administrador de tareas (o 'ps' / 'top' en Linux) permite visualizar y gestionar los procesos activos."
    },
    {
        q: "RA2 - ¬øQu√© estado indica que un hilo espera un recurso o evento?",
        options: ["Listo", "Bloqueado", "Terminado", "Ejecuci√≥n"],
        correct: 1, // B
        justification: "El estado 'Bloqueado' (Blocked/Waiting) ocurre cuando el hilo se detiene esperando algo (I/O, un monitor, etc.) y libera la CPU."
    },
    {
        q: "RA1 - ¬øQu√© caracteriza a la programaci√≥n paralela?",
        options: ["Ejecuci√≥n secuencial optimizada", "Ejecuci√≥n simult√°nea en varios procesadores o n√∫cleos", "Uso exclusivo de red", "Ausencia de comunicaci√≥n entre tareas"],
        correct: 1, // B
        justification: "La clave de la programaci√≥n paralela es dividir el trabajo para usar varios n√∫cleos a la vez (simultaneidad)."
    },
    {
        q: "RA5 - ¬øQu√© tipo de informaci√≥n debe cifrarse siempre?",
        options: ["C√≥digo fuente", "Archivos temporales", "Datos p√∫blicos", "Informaci√≥n sensible"],
        correct: 3, // D
        justification: "Toda informaci√≥n confidencial o sensible (contrase√±as, datos personales, bancarios) debe protegerse mediante cifrado."
    },
            {
        q: "RA2 - ¬øQu√© t√©cnica evita condiciones de carrera entre hilos?",
        options: ["Planificaci√≥n", "Serializaci√≥n", "Sincronizaci√≥n", "Compilaci√≥n"],
        correct: 2, // C
        justification: "La sincronizaci√≥n (con synchronized) coordina el acceso a recursos compartidos para evitar inconsistencias (condiciones de carrera)."
    },
    {
        q: "RA2 - ¬øQu√© ocurre cuando un hilo modifica un dato compartido?",
        options: ["El cambio se pierde", "El hilo se bloquea", "El dato se copia autom√°ticamente", "Los dem√°s hilos pueden ver el cambio"],
        correct: 3, // D
        justification: "Al compartir el mismo espacio de memoria del proceso, cualquier cambio en una variable com√∫n es visible inmediatamente para los dem√°s hilos."
    },
    {
        q: "RA3 - ¬øPara qu√© se usan hilos en servidores de red?",
        options: ["Reducir la seguridad", "Atender m√∫ltiples clientes simult√°neamente", "Eliminar la planificaci√≥n", "Evitar el uso de sockets"],
        correct: 1, // B
        justification: "El uso de hilos permite crear servidores concurrentes que no dejan esperando a un cliente mientras atienden a otro."
    }
            
        ];

        // --- APP LOGIC ---

        let quizQuestions = [];
        let currentQuestionIndex = 0;
        let score = 0;
        let isAnswered = false;

        const startScreen = document.getElementById('start-screen');
        const quizScreen = document.getElementById('quiz-screen');
        const resultScreen = document.getElementById('result-screen');
        
        const questionText = document.getElementById('question-text');
        const optionsContainer = document.getElementById('options-container');
        const currentQNum = document.getElementById('current-question-num');
        const totalQNum = document.getElementById('total-questions-num');
        const progressContainer = document.getElementById('progress-container');
        const feedbackArea = document.getElementById('feedback-area');
        const feedbackTitle = document.getElementById('feedback-title');
        const feedbackJustification = document.getElementById('feedback-justification');
        const feedbackIcon = document.getElementById('feedback-icon');
        const nextBtn = document.getElementById('next-btn');

        // Shuffle Array Helper
        function shuffle(array) {
            let currentIndex = array.length, randomIndex;
            while (currentIndex != 0) {
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex--;
                [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
            }
            return array;
        }

        // Initialize Quiz
        function startQuiz() {
            // 1. Prepare questions: deep copy
            let questions = JSON.parse(JSON.stringify(rawQuestions));
            
            // 2. Shuffle questions
            questions = shuffle(questions);
            
            // 3. Shuffle options for each question AND update the correct index
            questions.forEach(q => {
                const originalCorrectText = q.options[q.correct]; // Store the text of the correct answer
                q.options = shuffle(q.options); // Shuffle options
                q.correct = q.options.indexOf(originalCorrectText); // Find new index of correct answer
            });

            quizQuestions = questions;
            currentQuestionIndex = 0;
            score = 0;
            
            totalQNum.innerText = quizQuestions.length;
            
            startScreen.classList.add('hidden');
            resultScreen.classList.add('hidden');
            quizScreen.classList.remove('hidden');
            progressContainer.classList.remove('hidden');
            
            renderQuestion();
        }

        function renderQuestion() {
            isAnswered = false;
            const q = quizQuestions[currentQuestionIndex];
            
            // Update Text
            currentQNum.innerText = currentQuestionIndex + 1;
            questionText.innerText = q.q;
            
            // Clear Options & Feedback
            optionsContainer.innerHTML = '';
            feedbackArea.classList.add('hidden');
            
            // Render Options
            q.options.forEach((opt, index) => {
                const btn = document.createElement('button');
                btn.className = `option-card w-full text-left p-4 rounded-xl border-2 border-slate-200 bg-white hover:border-indigo-300 transition-all group flex items-start gap-3`;
                btn.onclick = () => checkAnswer(index, btn);
                
                const letter = String.fromCharCode(65 + index); // A, B, C, D...
                btn.innerHTML = `
                    <span class="flex-shrink-0 w-8 h-8 flex items-center justify-center bg-slate-100 text-slate-600 rounded-full font-bold group-hover:bg-indigo-100 group-hover:text-indigo-600 transition-colors">${letter}</span>
                    <span class="text-slate-700 font-medium pt-1">${opt}</span>
                `;
                optionsContainer.appendChild(btn);
            });
        }

        function checkAnswer(selectedIndex, selectedBtn) {
            if (isAnswered) return;
            isAnswered = true;

            const q = quizQuestions[currentQuestionIndex];
            const isCorrect = selectedIndex === q.correct;
            
            // Highlight Selected
            if (isCorrect) {
                score++;
                selectedBtn.classList.remove('border-slate-200', 'bg-white');
                selectedBtn.classList.add('border-green-500', 'bg-green-50');
                selectedBtn.querySelector('span:first-child').classList.add('bg-green-200', 'text-green-800');
                
                showFeedback(true, q.justification);
            } else {
                selectedBtn.classList.remove('border-slate-200', 'bg-white');
                selectedBtn.classList.add('border-red-500', 'bg-red-50');
                selectedBtn.querySelector('span:first-child').classList.add('bg-red-200', 'text-red-800');
                
                // Highlight Correct One
                const correctBtn = optionsContainer.children[q.correct];
                correctBtn.classList.remove('border-slate-200', 'bg-white');
                correctBtn.classList.add('border-green-500', 'bg-green-50');
                
                showFeedback(false, q.justification);
            }
        }

        function showFeedback(isCorrect, text) {
            feedbackArea.classList.remove('hidden');
            feedbackArea.className = `mt-6 p-4 rounded-lg border flex flex-col ${isCorrect ? 'bg-green-50 border-green-200' : 'bg-red-50 border-red-200'} fade-in`;
            
            feedbackIcon.innerHTML = isCorrect ? '<i class="fas fa-check-circle text-green-600"></i>' : '<i class="fas fa-times-circle text-red-600"></i>';
            feedbackTitle.innerText = isCorrect ? "¬°Correcto!" : "Incorrecto";
            feedbackTitle.className = `font-bold text-lg ${isCorrect ? 'text-green-800' : 'text-red-800'}`;
            
            feedbackJustification.innerText = text || "Sin justificaci√≥n disponible.";
            
            // Auto scroll to feedback on mobile
            if(window.innerWidth < 768) {
                feedbackArea.scrollIntoView({ behavior: 'smooth', block: 'end' });
            }
        }

        function nextQuestion() {
            currentQuestionIndex++;
            if (currentQuestionIndex < quizQuestions.length) {
                renderQuestion();
            } else {
                showResult();
            }
        }

        function showResult() {
            quizScreen.classList.add('hidden');
            progressContainer.classList.add('hidden');
            resultScreen.classList.remove('hidden');
            
            const total = quizQuestions.length;
            const percentage = (score / total) * 100;
            
            document.getElementById('final-score').innerText = `${score}/${total}`;
            
            // Animate Bar
            setTimeout(() => {
                document.getElementById('final-progress-bar').style.width = `${percentage}%`;
            }, 100);

            // Icon and Message
            const scoreCircle = document.getElementById('score-circle');
            const scoreMsg = document.getElementById('score-message');
            
            if (percentage >= 90) {
                scoreCircle.className = "w-24 h-24 mx-auto rounded-full flex items-center justify-center text-4xl shadow-lg relative bg-green-100 text-green-600 mb-4";
                scoreCircle.innerHTML = '<i class="fas fa-trophy"></i>';
                scoreMsg.innerText = "¬°Excelente! Eres un experto en PSP.";
            } else if (percentage >= 70) {
                scoreCircle.className = "w-24 h-24 mx-auto rounded-full flex items-center justify-center text-4xl shadow-lg relative bg-blue-100 text-blue-600 mb-4";
                scoreCircle.innerHTML = '<i class="fas fa-thumbs-up"></i>';
                scoreMsg.innerText = "¬°Muy bien! Tienes conocimientos s√≥lidos.";
            } else if (percentage >= 50) {
                scoreCircle.className = "w-24 h-24 mx-auto rounded-full flex items-center justify-center text-4xl shadow-lg relative bg-yellow-100 text-yellow-600 mb-4";
                scoreCircle.innerHTML = '<i class="fas fa-book-reader"></i>';
                scoreMsg.innerText = "Aprobado, pero podr√≠as repasar un poco m√°s.";
            } else {
                scoreCircle.className = "w-24 h-24 mx-auto rounded-full flex items-center justify-center text-4xl shadow-lg relative bg-red-100 text-red-600 mb-4";
                scoreCircle.innerHTML = '<i class="fas fa-exclamation-triangle"></i>';
                scoreMsg.innerText = "Necesitas estudiar m√°s. ¬°No te rindas!";
            }
        }

        function restartQuiz() {
            startQuiz();
        }
    </script>
</body>

</html>




